function getBounds(obj){var bounds={x:Infinity,y:Infinity,width:0,height:0};if(obj instanceof createjs.Container){var children=obj.children,l=children.length,cbounds,c;for(c=0;c<l;c++)cbounds=getBounds(children[c]),cbounds.x<bounds.x&&(bounds.x=cbounds.x),cbounds.y<bounds.y&&(bounds.y=cbounds.y),cbounds.width>bounds.width&&(bounds.width=cbounds.width),cbounds.height>bounds.height&&(bounds.height=cbounds.height)}else{var gp,gp2,gp3,gp4,imgr;if(obj instanceof createjs.Bitmap)imgr=obj.image;else{if(!(obj instanceof createjs.BitmapAnimation))return bounds;if(!(obj.spriteSheet._frames&&obj.spriteSheet._frames[obj.currentFrame]&&obj.spriteSheet._frames[obj.currentFrame].image))return bounds;imgr=obj.spriteSheet.getFrame(obj.currentFrame).rect}gp=obj.localToGlobal(0,0),gp2=obj.localToGlobal(imgr.width,imgr.height),gp3=obj.localToGlobal(imgr.width,0),gp4=obj.localToGlobal(0,imgr.height),bounds.x=Math.min(Math.min(Math.min(gp.x,gp2.x),gp3.x),gp4.x),bounds.y=Math.min(Math.min(Math.min(gp.y,gp2.y),gp3.y),gp4.y),bounds.width=Math.max(Math.max(Math.max(gp.x,gp2.x),gp3.x),gp4.x)-bounds.x,bounds.height=Math.max(Math.max(Math.max(gp.y,gp2.y),gp3.y),gp4.y)-bounds.y}return bounds}function IEhacks(){Array.prototype.indexOf||(Array.prototype.indexOf=function(elt){var len=this.length>>>0,from=Number(arguments[1])||0;from=from<0?Math.ceil(from):Math.floor(from),from<0&&(from+=len);for(;from<len;from++)if(from in this&&this[from]===elt)return from;return-1})}function mobilecheck(){var check=!1;return function(a){if(/(android|ipad|playbook|silk|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))check=!0}(navigator.userAgent||navigator.vendor||window.opera),check}function utf8_encode(argString){if(argString===null||typeof argString=="undefined")return"";var string=argString+"",utftext="",start,end,stringl=0;start=end=0,stringl=string.length;for(var n=0;n<stringl;n++){var c1=string.charCodeAt(n),enc=null;if(c1<128)end++;else if(c1>127&&c1<2048)enc=String.fromCharCode(c1>>6|192,c1&63|128);else if((c1&63488)!=55296)enc=String.fromCharCode(c1>>12|224,c1>>6&63|128,c1&63|128);else{if((c1&64512)!=55296)throw new RangeError("Unmatched trail surrogate at "+n);var c2=string.charCodeAt(++n);if((c2&64512)!=56320)throw new RangeError("Unmatched lead surrogate at "+(n-1));c1=((c1&1023)<<10)+(c2&1023)+65536,enc=String.fromCharCode(c1>>18|240,c1>>12&63|128,c1>>6&63|128,c1&63|128)}enc!==null&&(end>start&&(utftext+=string.slice(start,end)),utftext+=enc,start=end=n+1)}return end>start&&(utftext+=string.slice(start,stringl)),utftext}jQuery.easing.def="easeInOutExp";var $app=angular.module("popCornGarage",["ngRoute","ngResource","ngSanitize","ui.bootstrap","angulartics","angulartics.google.analytics"]);$app.directive("pwCheck",[function(){return{require:"ngModel",link:function(scope,elem,attrs,ctrl){var firstPassword="#"+attrs.pwCheck;elem.add(firstPassword).on("keyup",function(){scope.$apply(function(){var v=elem.val()===$(firstPassword).val();ctrl.$setValidity("pwmatch",v)})})}}}]),$app.service("translationService",function($resource){this.getTranslation=function($scope,language){var languageFilePath="lang/translation_"+language+".json";$resource(languageFilePath).get(function(data){$scope.translation=data,$scope.initApp()})}}),$app.controller("PopCornGarageCtrl",["$scope","$window","$document","$timeout","translationService","$analytics",function($scope,$window,$document,$timeout,translationService,$analytics){$scope.user={},$scope.user.score=0,$scope.user.errors=0,$scope.user.answers=[],$scope.user.badges=[],$scope.user.pins=[],$scope.user.logged=!1,$scope.user.gameStarted=!1,$scope.user.type="",$scope.movie={},$scope.view={},$scope.view.lang="fr",$scope.view.score="00",$scope.view.authErrorMsg="",$scope.view.profiletxt="plouc!",$scope.view.currentPanel=undefined,$scope.view.previousPanel=undefined,$scope.view.loadGame=!1,$scope.view.menu2ReturnButtonText="",$scope.view.menu2TitleText="",$scope.view.menu2SubTitleText="",$scope.view.menu2SubmitButtonText="",$scope.view.profiletxt="",$scope.view.profileShareImgFB="",$scope.view.profileShareImgTwitter="",$scope.view.profileShareImgGplus="",$scope.view.profileShareImgPin="",$scope.view.neonid="",$scope.game={},$scope.game.sparkleContainer=null,$scope.game.sparklePool=[],$scope.game.sparkleShape=null,$scope.game.sparksPerClick=42,$scope.game.defaultEasingFunc=Power1.easeInOut,$scope.game.FPS=80,$scope.game.DEBUG=!1,$scope.game.stage=null,$scope.game.container=null,$scope.game.layers=[],$scope.game.bounds={width:1680,height:705},$scope.game.pin,$scope.game.pinPool=[],$scope.game.pinPoolTimeline=[],$scope.game.pinVisible=!1,$scope.game.context="home",$scope.game.tweenSpeed=.4,$scope.game.inputMode=!1,$scope.game.hispot=null,$scope.game.lowspot=null,$scope.game.movieFoundPicto=null,$scope.game.bonusVideoPicto=null,$scope.game.congratsPicto=null,$scope.game.lauriers66=null,$scope.game.foundedMoviesIdx=[],$scope.game.ambianceTimer,$scope.game.ambianceTimeline,$scope.game.neonTimer=null,$scope.game.neonIdx=1,$scope.game.saveTooltip=!1,$scope.game.scoreTooltip=!1,$scope.game.errorsTooltip=!1,$scope.game.garageTooltip=!1,$scope.game.videoIframe,$scope.game.endTitle=null,$scope.game.sound=!0,$scope.game.mobileDevice=!1,$scope.game.sounds={},$scope.game.sounds.currentRadioID=0,$scope.game.sounds.foundSound=null,$scope.game.sounds.loopNeon=null,$scope.game.sounds.loopAmbiance=null,$scope.game.sounds.loopRadio=null,$scope.game.sounds.loopRadioTimerID=null,$scope.game.sounds.ambianceVolume=1,$scope.game.sounds.ambianceBackVolume=.4,$scope.game.sounds.ambianceNeonVolume=.2,$scope.game.sounds.ambianceLoopNeonVolume=.4,$scope.game.sounds.ambianceRadioVolume=.6,$scope.game.sounds.FOUND="bonne_reponse",$scope.game.sounds.WRONG="mauvaise_response",$scope.game.sounds.CLICK="click",$scope.game.sounds.BANJO="banjo",$scope.game.sounds.LIGHT_UP="LIGHT_UP",$scope.game.sounds.RADIO_ON="RADIO_ON",$scope.game.sounds.AMBIANCE="AMBIANCE",$scope.game.sounds.DEFI_GAGNE="DEFI_GAGNE",$scope.game.sounds.ALREADY_FOUND="ALREADY_FOUND",$scope.game.sounds.END="END",$scope.game.sounds.MENU="MENU",$scope.game.sounds.NEON_LOOP="NEON_LOOP",$scope.game.sounds.NEON_INTRO="NEON_INTRO",$scope.game.sounds.DOOR="DOOR",$scope.game.sounds.DOOR_OUT="DOOR_OUT",$scope.game.sounds.START_RADIO="START_RADIO",$scope.game.sounds.START_RADIO_LOW="START_RADIO_LOW",$scope.game.sounds.RADIO="RADIO",$scope.game.sounds.RADIO1="RADIO1",$scope.game.sounds.RADIO2="RADIO2",$scope.game.sounds.RADIO3="RADIO3",$scope.game.sounds.RADIO1_LOW="RADIO1_LOW",$scope.game.sounds.RADIO2_LOW="RADIO2_LOW",$scope.game.sounds.RADIO3_LOW="RADIO3_LOW",$scope.game.sounds.NEON_GARAGE="NEON_GARAGE",$scope.game.sounds.NEON_GARAGE1="NEON_GARAGE1",$scope.game.sounds.NEON_GARAGE2="NEON_GARAGE2",$scope.game.sounds.NEON_GARAGE3="NEON_GARAGE3",$scope.game.sounds.NEON_ON="NEON_ON",$scope.game.sounds.NEON_OFF="NEON_OFF",$document.ready(function(){$scope.initPanels(),$scope.preload(),$scope.initCanvas(),$scope.initRules(),$scope.initBadges(),$scope.initCredits(),$scope.initPopover(),$scope.initFBConnect(),$scope.detectMobileBrowser()}),$scope.preload=function(){createjs.Sound.initializeDefaultPlugins(),$scope.queue=new createjs.LoadQueue(!0,"assets/"),$scope.queue.installPlugin(createjs.Sound),$scope.queue.on("progress",$scope.handleProgress),$scope.queue.on("complete",$scope.handleComplete),$scope.queue.on("error",$scope.handleFileError),$scope.queue.setMaxConnections(3),$scope.queue.maintainScriptOrder=!0;var manifest=[{src:"sounds/allumage_neon_intro.mp3",id:$scope.game.sounds.NEON_INTRO},{src:"sounds/boucle_neon.mp3",id:$scope.game.sounds.NEON_LOOP},"img/homebg.jpg","img/mur.jpg","img/btnSmallBgOff.png","img/btnSmallBgOn.png","img/btnBgOn.png","img/btnBgOff.png","img/loadingShieldHome.png","img/loadingShieldHomeWhiteBg.png","img/btnLangBgOff.png","img/btnLangBgOn.png","img/headerbg0.jpg","img/headerbg.jpg","img/garage/bordure.png","img/garage/layer0.jpg","img/garage/layer1.jpg","img/garage/layer2.jpg","img/garage/layer3.jpg","img/garage/layer4.jpg","img/garage/layer5.jpg","img/garage/layer6.jpg","img/garage/layer7.jpg","img/garage/layer8.jpg","img/garage/layer9.jpg","img/garage/layer10.jpg","img/garage/layer11.jpg","img/garage/layer12.jpg","img/garage/layer13.jpg","img/garage/layer14.jpg","img/garage/ambiance1_dark.jpg","img/garage/ambiance2_dark.jpg","img/garage/ambiance3_dark.jpg","img/garage/ambiance1_light.jpg","img/garage/ambiance2_light.jpg","img/garage/ambiance3_light.jpg","img/garage/anonymousProfile.png","img/logoOff.png","img/logoOn.png","img/1_6.png","img/2_6.png","img/3_6.png","img/4_6.png","img/5_6.png","img/6_6.png","img/garage/blur0.jpg","img/garage/blur1.jpg","img/badges/unknownShield.png","img/credits/logo-celluloidz-off.png","img/credits/logo-celluloidz-on.png","img/credits/logo-priska-off.png","img/credits/logo-priska-on.png","img/credits/logo-rz-off.png","img/credits/logo-rz-on.png","img/tumblr-on.png","img/tumblr-off.png","img/garage/tooltip1.gif","img/btnSocialFacebook.png","img/btnSocialGoogle.png","img/btnSocialOff.png","img/btnSocialTwitter.png","img/check_icon.png","img/redcross_icon.png","img/cross_icon.png","img/warning_icon.png","img/menu-icon-off.png","img/menu-icon-on.png","img/garage/movieFoundfr.png","img/garage/movieFounden.png","img/x.png","img/garage/66.png","img/garage/congratsen.png","img/garage/congratsfr",{src:"sounds/click.mp3",id:$scope.game.sounds.CLICK},{src:"sounds/banjo.mp3",id:$scope.game.sounds.BANJO},{src:"sounds/allumage_garage.mp3",id:$scope.game.sounds.LIGHT_UP},{src:"sounds/allumage_radio.mp3",id:$scope.game.sounds.RADIO_ON},{src:"sounds/ambiance_interieur_garage.mp3",id:$scope.game.sounds.AMBIANCE},{src:"sounds/bonne_reponse.mp3",id:$scope.game.sounds.FOUND},{src:"sounds/mauvaise_reponse.mp3",id:$scope.game.sounds.WRONG},{src:"sounds/defi_gagne.mp3",id:$scope.game.sounds.DEFI_GAGNE},{src:"sounds/deja_trouve.mp3",id:$scope.game.sounds.ALREADY_FOUND},{src:"sounds/fin_perdu.mp3",id:$scope.game.sounds.END},{src:"sounds/menu.mp3",id:$scope.game.sounds.MENU},{src:"sounds/allumage_radio.mp3",id:$scope.game.sounds.START_RADIO},{src:"sounds/allumage_radio_low.mp3",id:$scope.game.sounds.START_RADIO_LOW},{src:"sounds/radio1.mp3",id:$scope.game.sounds.RADIO1},{src:"sounds/radio2.mp3",id:$scope.game.sounds.RADIO2},{src:"sounds/radio3.mp3",id:$scope.game.sounds.RADIO3},{src:"sounds/radio1_low.mp3",id:$scope.game.sounds.RADIO1_LOW},{src:"sounds/radio2_low.mp3",id:$scope.game.sounds.RADIO2_LOW},{src:"sounds/radio3_low.mp3",id:$scope.game.sounds.RADIO3_LOW},{src:"sounds/neon_garage_2.mp3",id:$scope.game.sounds.NEON_GARAGE1},{src:"sounds/neon_garage_2.mp3",id:$scope.game.sounds.NEON_GARAGE2},{src:"sounds/neon_garage_3.mp3",id:$scope.game.sounds.NEON_GARAGE3},{src:"sounds/neon_on.mp3",id:$scope.game.sounds.NEON_ON},{src:"sounds/neon_off.mp3",id:$scope.game.sounds.NEON_OFF},{src:"sounds/fermeture_porte.mp3",id:$scope.game.sounds.DOOR_OUT},{src:"sounds/ouverture_porte_intro.mp3",id:$scope.game.sounds.DOOR}];createjs.Sound.alternateExtensions=["ogg"],$scope.queue.loadManifest(manifest)},$scope.handleProgressStep=!1,$scope.handleProgress=function(event){var pourcentage=Math.round(event.progress*100);pourcentage=Math.round(pourcentage*66/100);var rough=new RoughEase({strength:15,points:20,template:Strong.easeInOut,taper:"in",randomize:!1});pourcentage>66&&(pourcentage=66);if(pourcentage>=42&&!$scope.handleProgressStep){TweenLite.to("#home-neon-img",1,{opacity:1,ease:rough}),$scope.playSoundId($scope.game.sounds.NEON_INTRO);var ppc=(new createjs.PlayPropsConfig).set({interrupt:createjs.Sound.INTERRUPT_ANY,loop:-1,volume:$scope.game.sounds.ambianceLoopNeonVolume});$scope.game.sounds.loopNeon=createjs.Sound.play($scope.game.sounds.NEON_LOOP,ppc),$scope.handleProgressStep=!0}pourcentage<10?$("#loadertxt").text("0"+pourcentage):$("#loadertxt").text(pourcentage)},$scope.handleComplete=function(){TweenLite.to("#loadertxt",$scope.game.tweenSpeed,{delay:.5,opacity:0,ease:$scope.game.defaultEasingFunc,onComplete:function(){$("#loadertxt").css("display","none"),TweenLite.to("#langbutton",$scope.game.tweenSpeed,{autoAlpha:1,ease:$scope.game.defaultEasingFunc})}}),$scope.initGarage(),$scope.initSound()},$scope.handleFileError=function(){},$scope.loadLang=function(lang){$scope.game.DEBUG&&console.log("scope.loadLang "+lang),$scope.view.lang=lang,$analytics.eventTrack("click-bouton",{category:"choix-langue",label:lang}),$scope.clickSound(),translationService.getTranslation($scope,$scope.view.lang),$scope.game.movieFoundPicto=new createjs.Bitmap("assets/img/garage/movieFound"+lang+".png"),$scope.game.container.addChild($scope.game.movieFoundPicto),$scope.game.movieFoundPicto.alpha=0,$scope.game.bonusVideoPicto=new createjs.Bitmap("assets/img/garage/bonusvideo"+lang+".png"),$scope.game.container.addChild($scope.game.bonusVideoPicto),$scope.game.bonusVideoPicto.alpha=0,$scope.game.congratsPicto=new createjs.Bitmap("assets/img/garage/congrats"+lang+".png"),$scope.game.container.addChild($scope.game.congratsPicto),$scope.game.congratsPicto.alpha=0,$scope.game.lauriers66=new createjs.Bitmap("assets/img/garage/66.png"),$scope.game.container.addChild($scope.game.lauriers66),$scope.game.lauriers66.alpha=0,TweenLite.to($scope.game.sounds.loopNeon,$scope.game.tweenSpeed,{volume:0,ease:$scope.game.defaultEasingFunc,onComplete:function(){$scope.game.sounds.loopNeon.stop()}})},$scope.initApp=function(){$document.bind("TwitterAuthSuccess",function(){$scope.getTwitterCred()}),$document.bind("TwitterShareSuccess",function(){$scope.TwitterShareOp()}),$document.bind("TwitterAuthFailed",function(){$scope.closeWaitWindow(),$scope.authError(),$scope.view.loadGame?$analytics.eventTrack("auth-error",{category:"reprendre-partie",label:"twitter"}):$analytics.eventTrack("auth-error",{category:"sauver-partie",label:"twitter"})}),$scope.playSoundId($scope.game.sounds.DOOR,.8),TweenLite.to("#home",$scope.game.tweenSpeed*2.5,{delay:.2,top:"-="+$("#home").height(),ease:$scope.game.defaultEasingFunc,onComplete:function(){$("#home").css("visibility","hidden")}}),$scope.view.currentPanel=$("#menu1")},$scope.initPanels=function(){$scope.game.DEBUG&&console.log("scope.initPanels"),$("#mainmenu").css("visibility","hidden").css("overflow","hidden"),$("#credits").css("visibility","hidden").css("overflow","hidden"),$("#videoplayer").css("visibility","hidden").css("overflow","hidden"),$("#rules").css("visibility","hidden").css("overflow","hidden"),$("#badges").css("visibility","hidden").css("overflow","hidden"),$("#garage").css("visibility","hidden").css("overflow","hidden"),$("#menu2").css("visibility","hidden").css("overflow","hidden"),$("#logged").css("visibility","hidden").css("overflow","hidden"),$("#saved").css("visibility","hidden").css("overflow","hidden"),$("#saved2").css("visibility","hidden").css("overflow","hidden"),$("#register").css("visibility","hidden").css("overflow","hidden"),$("#registered").css("visibility","hidden").css("overflow","hidden"),$("#lostpassword").css("visibility","hidden").css("overflow","hidden"),$("#emailsent").css("visibility","hidden").css("overflow","hidden"),$("#end").css("visibility","hidden").css("overflow","hidden"),$("#langbutton").css("visibility","hidden").css("overflow","hidden"),$("#wait").css("visibility","hidden").css("overflow","hidden"),$("#autherror").css("visibility","hidden").css("overflow","hidden"),$("#quitconfirm").css("visibility","hidden").css("overflow","hidden")},$scope.initCanvas=function(){$scope.game.DEBUG&&console.log("scope.initCanvas"),$scope.game.stage=new createjs.Stage("garageCanvas"),$scope.game.stage.enableMouseOver(20),$scope.animate(),$(window).resize($scope.onResizeCanvas),$scope.onResizeCanvas()},$scope.detectMobileBrowser=function(){},$scope.animate=function(){$timeout(function(){requestAnimationFrame($scope.animate),$scope.handleTick()},1e3/$scope.game.FPS)},$scope.handleTick=function(event){if($scope.game.sparkleContainer){var l=$scope.game.sparkleContainer.getNumChildren();if(l>0){var h=$scope.game.stage.canvas.height,w=$scope.game.stage.canvas.width;for(var i=l-1;i>=0;i--){var sparkle=$scope.game.sparkleContainer.getChildAt(i);sparkle.vY+=.05,sparkle.vX*=.98,sparkle.x+=sparkle.vX,sparkle.y+=sparkle.vY,sparkle.alpha+=sparkle.vA;if(sparkle.alpha<=0||sparkle.y>=h&&sparkle.vY<10){$scope.game.sparkleContainer.removeChildAt(i),$scope.game.sparklePool.push(sparkle);continue}sparkle.y>h&&(sparkle.vY*=-(Math.random()*.4+.4),sparkle.y-=sparkle.y%h);if(sparkle.x>=w||sparkle.x<=0)sparkle.vX*=-1}}}$scope.game.stage.update()},$scope.onResizeCanvasOld=function(){var c=$("#garageCanvas");c.attr("width",$("#garageContainer").width()),c.attr("height",$(window).height()-260);if($scope.game.container!=undefined){var currentScale=$scope.game.stage.canvas.width/$scope.game.bounds.width;currentScale>1&&(currentScale=1);var newH=$scope.game.bounds.height*currentScale;newH>$scope.game.stage.canvas.height&&(currentScale=$scope.game.stage.canvas.height/$scope.game.bounds.height,newH=$scope.game.bounds.height*currentScale),$scope.game.container.scaleX=$scope.game.container.scaleY=currentScale,$scope.game.container.x=($scope.game.stage.canvas.width-$scope.game.bounds.width*currentScale)/2,c.attr("height",newH)}},$scope.onResizeCanvas=function(){var c=$("#garageCanvas");c.attr("width",$("#garageContainer").width()),$("#garageContainer").width()>=1200?c.attr("height",$(window).height()-240):c.attr("height",$(window).height()-200);if($scope.game.container!=undefined){var currentScale=$scope.game.stage.canvas.width/$scope.game.bounds.width;currentScale>1.2&&(currentScale=1.2);var newH=$scope.game.bounds.height*currentScale;newH>$scope.game.stage.canvas.height&&(currentScale=$scope.game.stage.canvas.height/$scope.game.bounds.height,newH=$scope.game.bounds.height*currentScale),$scope.game.container.scaleX=$scope.game.container.scaleY=currentScale,$scope.game.container.x=($scope.game.stage.canvas.width-$scope.game.bounds.width*currentScale)/2,c.attr("height",newH)}},$scope.initSound=function(){},$scope.initGarage=function(){$scope.game.container=new createjs.Container,$scope.game.stage.addChild($scope.game.container);for(var i=0;i<15;i++){var layer=new createjs.Bitmap("assets/img/garage/layer"+i+".jpg");$scope.game.layers.push(layer),layer.cache(0,0,$scope.game.bounds.width,$scope.game.bounds.height),$scope.game.container.addChild(layer),layer.alpha=0}for(var i=1;i<4;i++){var maskX=[0,200,1100,650],light=new createjs.Bitmap("assets/img/garage/ambiance"+i+"_light.jpg");$scope.game.layers.push(light),light.cache(maskX[i],0,400,705),$scope.game.container.addChild(light),light.alpha=0;var dark=new createjs.Bitmap("assets/img/garage/ambiance"+i+"_dark.jpg");$scope.game.layers.push(dark),dark.cache(maskX[i],0,450,705),$scope.game.container.addChild(dark),dark.alpha=0}$scope.createHighlightSpot();var blur1=new createjs.Bitmap("assets/img/garage/blur1.jpg");$scope.game.layers.push(blur1);var blur0=new createjs.Bitmap("assets/img/garage/blur0.jpg");$scope.game.layers.push(blur0),blur0.alpha=0,blur1.alpha=0,$scope.game.container.addChild(blur1,blur0);var bordure=new createjs.Bitmap("assets/img/garage/bordure.png");bordure.alpha=.6,$scope.game.container.addChild(bordure),$("#menulink").mouseover(function(){$("#main-menu-icon").attr("src","assets/img/menu-icon-on.png")}).mouseout(function(){$("#main-menu-icon").attr("src","assets/img/menu-icon-off.png")}),$("#main-logo").fadeTo(0,0),$("#inputfield").fadeTo(0,0),$("#header").fadeTo(0,0),$(".btn-score").mouseover(function(){$("#end-score").css("display","none"),$("#end-bonus").css("display","inline")}).mouseout(function(){$("#end-score").css("display","inline"),$("#end-bonus").css("display","none")}),$scope.makeSparkle(),$scope.onResizeCanvas()},$scope.makeSparkle=function(){$scope.game.sparkleContainer=new createjs.Container,$scope.game.container.addChild($scope.game.sparkleContainer);var img=new Image;img.src="assets/img/garage/corn.png",img.onload=function(evt){$scope.game.sparkleShape=new createjs.Bitmap(img),$scope.game.sparkleShape.cache(0,0,$scope.game.sparkleShape.image.width,$scope.game.sparkleShape.image.height)}},$scope.blurGarage=function(status){$scope.game.DEBUG&&console.log("scope.blurGarage "+status);if(status){var tl=new TimelineLite;tl.to($scope.game.layers[22],$scope.game.tweenSpeed/2,{alpha:1,ease:$scope.game.defaultEasingFunc}),tl.to($scope.game.layers[21],0,{alpha:1}),tl.to($scope.game.layers[22],$scope.game.tweenSpeed/2,{alpha:0,ease:$scope.game.defaultEasingFunc}),tl.play()}else createjs.Tween.get($scope.game.layers[21]).to({alpha:0},$scope.game.tweenSpeed,createjs.Ease.circOut),$scope.game.inputMode=!0,$scope.showInputField()},$scope.getRandom=function(min,max){var randomNumber=Math.random()*(max-min)+min;return Math.floor(randomNumber)},$scope.generateAmbianceSeq=function(){var delay=$scope.getRandom(3,5);$scope.game.ambianceTimer=$timeout($scope.startAmbiance,delay*1e3)},$scope.clickSound=function(){$scope.playSoundId($scope.game.sounds.CLICK,.2)},$scope.toggleSound=function(){$scope.clickSound(),$scope.game.sound?(TweenLite.to(createjs.Sound,$scope.game.tweenSpeed,{volume:0,ease:$scope.game.defaultEasingFunc}),$analytics.eventTrack("click-bouton",{category:"footer",label:"sound-off"})):(TweenLite.to(createjs.Sound,$scope.game.tweenSpeed,{volume:1,ease:$scope.game.defaultEasingFunc}),$analytics.eventTrack("click-bouton",{category:"footer",label:"sound-on"})),$scope.game.sound=!$scope.game.sound},$scope.playSoundId=function(id,volume){typeof volume=="undefined"&&(volume=1);var ppc=(new createjs.PlayPropsConfig).set({volume:volume});return createjs.Sound.play(id,ppc)},$scope.playMovieFoundSound=function(){$scope.game.sounds.loopRadio&&TweenLite.to($scope.game.sounds.loopRadio,$scope.game.tweenSpeed/2,{volume:.2,ease:$scope.game.defaultEasingFunc}),$scope.game.sounds.foundSound=$scope.playSoundId($scope.game.sounds.FOUND),$scope.game.sounds.foundSound.on("complete",function(){$scope.game.sounds.loopRadio&&TweenLite.to($scope.game.sounds.loopRadio,$scope.game.tweenSpeed,{volume:$scope.game.sounds.ambianceRadioVolume,ease:$scope.game.defaultEasingFunc})})},$scope.startAmbianceSound=function(){var ppc=(new createjs.PlayPropsConfig).set({interrupt:createjs.Sound.INTERRUPT_ANY,loop:-1,volume:$scope.game.sounds.ambianceBackVolume});$scope.game.sounds.loopAmbiance=createjs.Sound.play($scope.game.sounds.AMBIANCE,ppc),$scope.game.sounds.loopRadioTimerID=$timeout($scope.startRadio,1e4)},$scope.stopAmbianceSound=function(){TweenLite.to($scope.game.sounds.loopAmbiance,$scope.game.tweenSpeed,{volume:0,ease:$scope.game.defaultEasingFunc,onComplete:function(){$scope.game.sounds.loopAmbiance.stop()}})},$scope.getNextRadioId=function(){return $scope.game.sounds.currentRadioID==0?$scope.game.sounds.currentRadioID=$scope.getRandom(1,3):($scope.game.sounds.currentRadioID+=1,$scope.game.sounds.currentRadioID>3&&($scope.game.sounds.currentRadioID=1)),$scope.game.sounds.currentRadioID},$scope.startRadio=function(){$scope.game.DEBUG&&console.log("$scope.startRadio");var startVolume=$scope.game.sounds.ambianceRadioVolume;$scope.game.sounds.ambianceVolume==0&&(startVolume=.2),$scope.game.sounds.loopRadio=$scope.playSoundId($scope.game.sounds.START_RADIO,startVolume),$scope.game.sounds.loopRadio.on("complete",function(){var seq=$scope.getNextRadioId();$scope.game.DEBUG&&console.log("$scope.startRadio play "+seq),$scope.game.sounds.ambianceVolume==0&&(startVolume=.2),$scope.game.sounds.loopRadio=$scope.playSoundId($scope.game.sounds.RADIO+""+seq,startVolume),$scope.game.sounds.loopRadio.on("complete",function(){$scope.game.sounds.loopRadioTimerID=$timeout($scope.startRadio,8e3)})})},$scope.stopRadio=function(){$timeout.cancel($scope.game.sounds.loopRadioTimerID),$scope.game.sounds.loopRadio&&TweenLite.to($scope.game.sounds.loopRadio,$scope.game.tweenSpeed,{volume:0,ease:$scope.game.defaultEasingFunc,onComplete:function(){$scope.game.sounds.loopRadio.stop()}})},$scope.startAmbiance=function(){var seq=$scope.getRandom(1,4),layersIdx=[15,17,19],idx=layersIdx[Math.floor(Math.random()*3)],layers=$scope.game.layers,alphaVal=1;idx=15,$scope.game.ambianceTimeline=new TimelineLite({autoRemoveChildren:!0,onComplete:$scope.generateAmbianceSeq});var rough=new RoughEase({strength:10,points:50,template:Strong.easeInOut,taper:"both",randomize:!0}),rough2=new RoughEase({strength:10,points:50,template:Strong.easeInOut,taper:"both",randomize:!0}),rough3=new RoughEase({strength:10,points:50,template:Strong.easeInOut,taper:"in",randomize:!0});switch(seq){case 1:$scope.game.ambianceTimeline.to(layers[idx],2,{easel:{alpha:alphaVal},ease:rough,onStart:function(){$scope.playSoundId($scope.game.sounds.NEON_GARAGE1,$scope.game.sounds.ambianceNeonVolume*$scope.game.sounds.ambianceVolume)}}),$scope.game.ambianceTimeline.to(layers[idx],1,{easel:{alpha:0},ease:rough,onStart:function(){}},"+=0.5"),$scope.game.ambianceTimeline.to(layers[idx+2],2,{easel:{alpha:alphaVal},ease:rough2,onStart:function(){$scope.playSoundId($scope.game.sounds.NEON_GARAGE2,$scope.game.sounds.ambianceNeonVolume*$scope.game.sounds.ambianceVolume)}},"-=2.5"),$scope.game.ambianceTimeline.to(layers[idx+2],1,{easel:{alpha:0},ease:rough2,onStart:function(){}},"+=0.5"),$scope.game.ambianceTimeline.to(layers[idx+4],2,{easel:{alpha:alphaVal},ease:rough3,onStart:function(){$scope.playSoundId($scope.game.sounds.NEON_GARAGE3,$scope.game.sounds.ambianceNeonVolume*$scope.game.sounds.ambianceVolume)}},"-=3"),$scope.game.ambianceTimeline.to(layers[idx+4],1,{easel:{alpha:0},ease:rough3,onStart:function(){}});break;case 2:$scope.game.ambianceTimeline.to(layers[idx+2],2,{easel:{alpha:alphaVal},ease:rough,onStart:function(){$scope.playSoundId($scope.game.sounds.NEON_GARAGE2,$scope.game.sounds.ambianceNeonVolume*$scope.game.sounds.ambianceVolume)}}),$scope.game.ambianceTimeline.to(layers[idx+2],1,{easel:{alpha:0},ease:rough,onStart:function(){}},"+=0.5"),$scope.game.ambianceTimeline.to(layers[idx],2,{easel:{alpha:alphaVal},ease:rough2,onStart:function(){$scope.playSoundId($scope.game.sounds.NEON_GARAGE1,$scope.game.sounds.ambianceNeonVolume*$scope.game.sounds.ambianceVolume)}},"-=2.5"),$scope.game.ambianceTimeline.to(layers[idx],1,{easel:{alpha:0},ease:rough2,onStart:function(){}},"+=0.5"),$scope.game.ambianceTimeline.to(layers[idx+4],2,{easel:{alpha:alphaVal},ease:rough3,onStart:function(){$scope.playSoundId($scope.game.sounds.NEON_GARAGE3,$scope.game.sounds.ambianceNeonVolume*$scope.game.sounds.ambianceVolume)}},"-=3"),$scope.game.ambianceTimeline.to(layers[idx+4],1,{easel:{alpha:0},ease:rough3,onStart:function(){}});break;case 3:$scope.game.ambianceTimeline.to(layers[idx+4],2,{easel:{alpha:alphaVal},ease:rough,onStart:function(){$scope.playSoundId($scope.game.sounds.NEON_GARAGE3,$scope.game.sounds.ambianceNeonVolume*$scope.game.sounds.ambianceVolume)}}),$scope.game.ambianceTimeline.to(layers[idx+4],1,{easel:{alpha:0},ease:rough,onStart:function(){}},"+=0.5"),$scope.game.ambianceTimeline.to(layers[idx+2],2,{easel:{alpha:alphaVal},ease:rough2,onStart:function(){$scope.playSoundId($scope.game.sounds.NEON_GARAGE2,$scope.game.sounds.ambianceNeonVolume*$scope.game.sounds.ambianceVolume)}},"-=2.5"),$scope.game.ambianceTimeline.to(layers[idx+2],1,{easel:{alpha:0},ease:rough2,onStart:function(){}},"+=0.5"),$scope.game.ambianceTimeline.to(layers[idx],2,{easel:{alpha:alphaVal},ease:rough3,onStart:function(){$scope.playSoundId($scope.game.sounds.NEON_GARAGE1,$scope.game.sounds.ambianceNeonVolume*$scope.game.sounds.ambianceVolume)}},"-=3"),$scope.game.ambianceTimeline.to(layers[idx],1,{easel:{alpha:0},ease:rough3,onStart:function(){}})}$scope.game.ambianceTimeline.play()},$scope.cancelAmbiance=function(){$scope.game.DEBUG&&console.log("$scope.cancelAmbiance"),$scope.stopRadio(),$timeout.cancel($scope.game.ambianceTimer),$scope.game.ambianceTimeline&&($scope.game.ambianceTimeline.clear(),$scope.game.ambianceTimeline.eventCallback("onComplete",null));var tl=new TimelineLite({autoRemoveChildren:!0}),idx=15;tl.to($scope.game.layers[idx],0,{easel:{alpha:0},overwrite:"all"}),tl.to($scope.game.layers[idx+2],0,{easel:{alpha:0},overwrite:"all"}),tl.to($scope.game.layers[idx+4],0,{easel:{alpha:0},overwrite:"all"}),tl.play()},$scope.errorAmbiance=function(){$scope.game.DEBUG&&console.log("scope.errorAmbiance"),$scope.cancelAmbiance(),$scope.game.ambianceTimeline=new TimelineLite({autoRemoveChildren:!0,onComplete:$scope.generateAmbianceSeq});var rough=new RoughEase({strength:10,points:30,template:Strong.easeInOut,taper:"both",randomize:!1});$scope.game.ambianceTimeline.to($scope.game.layers[10],$scope.game.tweenSpeed*3,{easel:{alpha:1},ease:rough,onStart:function(){$timeout(function(){$scope.errorLogoNeon(10)},$scope.game.tweenSpeed*1e3)}}),$scope.game.ambianceTimeline.to($scope.game.layers[10],$scope.game.tweenSpeed,{easel:{alpha:0},ease:Strong.easeOut}),$scope.game.ambianceTimeline.play(),$scope.playSoundId($scope.game.sounds.WRONG)},$scope.errorLogoNeon=function(max){max%2?$(".main-logo-holder").css("background-image","url(assets/img/logoOn.png)"):$(".main-logo-holder").css("background-image","url(assets/img/logoOff.png)"),max--,max>0?$scope.game.neonTimer=setTimeout(function(){$scope.errorLogoNeon(max)},25):$scope.game.errorsTooltip&&$scope.showErrorPopOver()},$scope.lightUpGarage=function(){var rough=new RoughEase({strength:10,points:30,template:Strong.easeInOut,taper:"in",randomize:!1}),layers=$scope.game.layers;$scope.game.DEBUG&&console.log("$scope.lightUpGarage");var animation_speed=$scope.game.tweenSpeed/2,tl=new TimelineLite;tl.to(layers[0],animation_speed*2,{easel:{alpha:1},ease:Circ.easeOut}),tl.to(layers[1],animation_speed*2,{easel:{alpha:1},ease:rough}),tl.to(layers[2],animation_speed,{easel:{alpha:1},ease:Circ.easeOut}),tl.to(layers[3],animation_speed*2,{easel:{alpha:1},ease:rough}),tl.to(layers[4],animation_speed*2,{easel:{alpha:1},ease:rough}),tl.to(layers[5],animation_speed*2,{easel:{alpha:1},ease:rough}),tl.to(layers[6],animation_speed,{easel:{alpha:1},ease:Circ.easeOut}),tl.to(layers[7],animation_speed*2,{easel:{alpha:1},ease:rough}),tl.to(layers[8],animation_speed,{easel:{alpha:1},ease:Quad.easeInOut,onComplete:function(){$("#inputfieldtxt").val(""),$scope.game.mobileDevice||$("#inputfieldtxt").focus(),$("#garage").addClass("bg-garage"),TweenLite.to("#main-logo",animation_speed*2,{opacity:1,ease:Circ.easeOut,onComplete:function(){$(".main-logo-holder").css("background-image","url(assets/img/logoOn.png)")}}),TweenLite.to("#inputfield",animation_speed*2,{opacity:1,ease:Circ.easeOut}),TweenLite.to("#header",animation_speed*2,{opacity:1,ease:Circ.easeOut})}}),tl.to(layers[9],animation_speed*2,{easel:{alpha:1},ease:Quad.easeInOut,onComplete:function(){$scope.game.container.removeChild(0,1,2,3,4,5,6,7,8),$scope.generateAmbianceSeq(),$scope.addGarageEvents(),$scope.startAmbianceSound(),$("#badges_slides").data("superslides").animate($("#badges_slides").data("superslides").size()-1),$("#badges_slides").data
("superslides").animate(0)}}),tl.play(),$scope.playSoundId($scope.game.sounds.LIGHT_UP)},$scope.addGarageEvents=function(){$scope.game.container.addEventListener("click",$scope.showPins),$("#inputfieldtxt").focus($scope.onInputFieldFocus),$("#mainmenu").on("click",function(event){$scope.game.DEBUG&&console.log("event.target : "+event.target.nodeName),event.target.nodeName!="BUTTON"&&($scope.game.sounds.ambianceVolume=1,TweenLite.to($scope.game.sounds.loopAmbiance,$scope.game.tweenSpeed,{volume:$scope.game.sounds.ambianceBackVolume,ease:$scope.game.defaultEasingFunc}),$scope.game.sounds.loopRadio&&TweenLite.to($scope.game.sounds.loopRadio,$scope.game.tweenSpeed,{volume:$scope.game.sounds.ambianceRadioVolume,ease:$scope.game.defaultEasingFunc}),TweenLite.to("#mainmenu",$scope.game.tweenSpeed,{autoAlpha:0,ease:$scope.game.defaultEasingFunc}),$scope.blurGarage(!1))}),$("#saved").on("click",function(event){$scope.game.DEBUG&&console.log("event.target : "+event.target.nodeName),event.target.nodeName!="A"&&(TweenLite.to("#saved",$scope.game.tweenSpeed,{autoAlpha:0,ease:$scope.game.defaultEasingFunc}),$scope.blurGarage(!1))}),$("#saved2").on("click",function(event){$scope.game.DEBUG&&console.log("event.target : "+event.target.nodeName),event.target.nodeName!="A"&&(TweenLite.to("#saved2",$scope.game.tweenSpeed,{autoAlpha:0,ease:$scope.game.defaultEasingFunc}),$scope.blurGarage(!1))})},$scope.removeGarageEvents=function(){$scope.game.container.removeEventListener("click",$scope.showPins)},$scope.showInputField=function(keeptext){$scope.game.DEBUG&&console.log("$scope.showInputField [$scope.game.inputMode="+$scope.game.inputMode+"]"),$scope.game.inputMode=!0,$("#inputfieldtxt").prop("disabled",!1),$scope.game.mobileDevice?keeptext||$("#inputfieldtxt").val(""):keeptext?$("#inputfieldtxt").focus():$("#inputfieldtxt").val("").focus()},$scope.hideInputField=function(){$scope.game.DEBUG&&console.log("$scope.hideInputField before call -> [$scope.game.inputMode="+$scope.game.inputMode+"]"),$scope.game.inputMode=!1,$("#inputfieldtxt").prop("disabled",!0)},$scope.unfocusInputField=function(){$scope.game.DEBUG&&console.log("unfocusInputField"),$("#inputfieldtxt").blur()},$scope.onInputFieldFocus=function(){$scope.game.DEBUG&&console.log("$scope.onInputFieldFocus [$scope.game.inputMode="+$scope.game.inputMode+"]"),$scope.game.inputMode==1?$scope.hidePins():$("#inputfieldtxt").blur()},$scope.createHighlightSpot=function(){$scope.game.hispot=new createjs.Shape,$scope.game.hispot.graphics.beginStroke("#ffffff"),$scope.game.hispot.graphics.setStrokeStyle(2),$scope.game.hispot.graphics.beginRadialGradientFill(["rgba(255, 255, 255, 1)","rgba(255, 255, 255, 0)"],[0,1],0,0,0,0,0,50).drawCircle(0,0,50),$scope.game.container.addChild($scope.game.hispot),$scope.game.hispot.alpha=0,$scope.game.lowspot=new createjs.Shape,$scope.game.lowspot.graphics.beginFill("#000000").drawRect(0,0,$scope.game.bounds.width,$scope.game.bounds.height),$scope.game.container.addChild($scope.game.lowspot),$scope.game.lowspot.alpha=0,$scope.createPin()},$scope.createPin=function(){$scope.game.pin=new createjs.Container,$scope.game.pin.name="Pin",$scope.game.DEBUG&&console.log("createPin pin : "+$scope.game.pin);var pin=new createjs.Shape;pin.name="Pin.circle",pin.graphics.beginStroke("#ffffff"),pin.graphics.setStrokeStyle(2),pin.graphics.beginFill("#ffffff").drawCircle(0,0,5);var onde=new createjs.Shape;onde.name="Pin.onde",onde.graphics.beginStroke("#ffffff"),onde.graphics.setStrokeStyle(1),onde.graphics.drawCircle(0,0,5),$scope.game.DEBUG&&console.log("createPin pin child : "+pin),$scope.game.pin.addChild(pin),$scope.game.pin.addChild(onde),$scope.game.DEBUG&&console.log("createPin pin getNumChildren : "+$scope.game.pin.getNumChildren()),$scope.game.DEBUG&&console.log("createPin pin circle : "+$scope.game.pin.getChildAt(0))},$scope.getPin=function(){var s;return s=$scope.game.pin.clone(!0),$scope.game.DEBUG&&console.log("getPin pin getNumChildren : "+s.getNumChildren()),$scope.game.DEBUG&&console.log("getPin pin circle : "+s.getChildAt(0)),s},$scope.addPin=function(x,y){var p=$scope.getPin();$scope.game.DEBUG&&console.log("pin : "+p),p.regX=p.width/2,p.regY=p.height/2,p.x=x,p.y=y,p.scaleX=p.scaleY=0,p.alpha=0,$scope.game.pinPool.push(p),$scope.game.container.addChild(p)},$scope.resetPins=function(){if($scope.game.pinPool.length>0)for(var i=0;i<$scope.game.pinPool.length;i++){var p=$scope.game.pinPool[i];$scope.game.container.removeChild(p)}},$scope.showPins=function(event){if(!$scope.game.scoreTooltip||!$scope.game.errorsTooltip||!$scope.game.saveTooltip){$scope.clickSound();if($scope.game.pinVisible==0){$scope.game.DEBUG&&console.log("scope.showPins"),$scope.game.pinVisible=!0;if($scope.game.pinPool.length>0){$scope.unfocusInputField(),TweenLite.to($scope.game.lowspot,.5,{easel:{alpha:.6},ease:Circ.easeOut,overwrite:"all"});for(var i=0;i<$scope.game.pinPool.length;i++){var p=$scope.game.pinPool[i];TweenMax.to(p,.6,{easel:{alpha:.9,scaleX:1,scaleY:1},ease:Power1.easeInOut,overwrite:"all",onComplete:$scope.animatePinOnde,onCompleteParams:[i]})}}}else $scope.showInputField(),$scope.hidePins()}},$scope.animatePinOnde=function(i){var p=$scope.game.pinPool[i];if(typeof $scope.game.pinPoolTimeline[i]=="undefined"){var tl=new TimelineMax({repeat:-1});tl.to(p.getChildAt(1),0,{easel:{alpha:1,scaleX:1,scaleY:1,overwrite:"all"}}),tl.to(p.getChildAt(1),1,{easel:{alpha:0,scaleX:3,scaleY:3,ease:Power1.easeOut}}),tl.play(),$scope.game.pinPoolTimeline.push(tl)}else $scope.game.pinPoolTimeline[i].restart()},$scope.hidePins=function(){$scope.game.DEBUG&&console.log("$scope.hidePins");if($scope.game.pinPool.length>0){for(var i=0;i<$scope.game.pinPool.length;i++){var p=$scope.game.pinPool[i];TweenMax.to(p,.6,{easel:{alpha:0,scaleX:0,scaleY:0},ease:Power1.easeInOut,overwrite:"all",onComplete:$scope.stopAnimOnde,onCompleteParams:[i]})}TweenLite.to($scope.game.lowspot,.5,{easel:{alpha:0},ease:Circ.easeOut,overwrite:"all"})}$scope.game.pinVisible=!1,$scope.game.inputMode=!0},$scope.stopAnimOnde=function(i){var p=$scope.game.pinPool[i];$scope.game.pinPoolTimeline[i]&&($scope.game.pinPoolTimeline[i].pause(),TweenLite.to(p.getChildAt(1),0,{easel:{alpha:1,scaleX:1,scaleY:1,overwrite:"all"}}))},$scope.showHighlightSpot=function(x,y,badgeid,founded){if(x==0&&y==0)return;$scope.game.hispot.x=x,$scope.game.hispot.y=y,$scope.game.hispot.alpha=.85,$scope.game.hispot.scaleX=1,$scope.game.hispot.scaleY=1,TweenMax.to($scope.game.hispot,.5,{easel:{alpha:0,scaleX:0,scaleY:0},ease:Power1.easeIn,repeat:2,yoyo:!0,repeatDelay:0,overwrite:"all",onComplete:function(){$scope.addPin(x,y),$scope.game.inputMode=!0,$scope.showInputField(),$scope.game.scoreTooltip&&$scope.showScorePopOver(),$scope.game.garageTooltip&&$scope.showGaragePopOver(),$scope.game.saveTooltip&&$scope.showSavePopOver()}})},$scope.setBadgeSize=function(obj,max){var imgRatio=obj.image.width/obj.image.height;console.log("obj.image.width : "+obj.image.width);var realWidth=$scope.game.bounds.width*max/1680,pourcentage=1-$scope.game.stage.canvas.width/$scope.game.bounds.width,newWidth=max+max*pourcentage;newWidth=max,pourcentage=newWidth/obj.image.width,obj.scaleX=obj.scaleY=Math.round(100*(newWidth/obj.image.width))/100},$scope.showBadgeDiscovered=function(x,y,badgeid,founded){var img=new Image;img.src="assets/img/badges/roll-2x/"+badgeid+".png",img.onload=function(evt){console.log("badge loaded");var badgeScale=1,bonusScale=1,badge=new createjs.Bitmap(img);$scope.game.container.addChild(badge),$scope.setBadgeSize(badge,300),$scope.setBadgeSize($scope.game.movieFoundPicto,200),$scope.setBadgeSize($scope.game.bonusVideoPicto,190),console.log("badge.scaleX : "+badge.scaleX),badgeScale=badge.scaleX,bonusScale=$scope.game.bonusVideoPicto.scaleX,badge.cache(0,0,badge.image.width,badge.image.height),badge.alpha=0,$scope.game.stage.update(),badge.regX=badge.image.width/2,badge.regY=badge.image.height/2,badge.x=$scope.game.bounds.width/2,$scope.game.movieFoundPicto.regX=$scope.game.movieFoundPicto.image.width/2,$scope.game.movieFoundPicto.regY=$scope.game.movieFoundPicto.image.height/2,$scope.game.movieFoundPicto.x=$scope.game.bounds.width/2,$scope.game.bonusVideoPicto.regX=$scope.game.bonusVideoPicto.image.width/2,$scope.game.bonusVideoPicto.regY=$scope.game.bonusVideoPicto.image.height/2,$scope.game.bonusVideoPicto.x=$scope.game.bounds.width/2;var posy=$scope.game.bounds.height/2;badge.scaleX=badge.scaleY=.1,badge.y=posy;var raysy=$scope.game.movieFoundPicto.y=posy-badge.regY*badgeScale-50;$scope.game.movieFoundPicto.y=raysy-100,$scope.game.bonusVideoPicto.y=raysy+badge.image.height*badgeScale+80,$scope.game.bonusVideoPicto.scaleX=.2,founded?($scope.playMovieFoundSound(),TweenLite.to($scope.game.lowspot,.5,{easel:{alpha:.8},ease:Power3.easeOut}),TweenLite.to($scope.game.bonusVideoPicto,.8,{delay:.5,easel:{alpha:1,scaleX:bonusScale},ease:Elastic.easeOut,onStart:function(){$scope.game.sparksPerClick=$scope.getRandom(42,100),$scope.addSparkles(Math.random()*$scope.game.sparksPerClick+$scope.game.sparksPerClick|0,$scope.game.bounds.width/2,$scope.game.bounds.height/2,1.1,0)}}),TweenLite.to($scope.game.movieFoundPicto,.5,{easel:{alpha:1,y:raysy},ease:Back.easeInOut}),TweenLite.to(badge,.5,{easel:{alpha:1,scaleX:badgeScale,scaleY:badgeScale},ease:Back.easeOut,onComplete:function(){$scope.user.score!=66&&TweenLite.to($scope.game.lowspot,.5,{delay:2,easel:{alpha:0},ease:Power3.easeOut}),TweenLite.to($scope.game.movieFoundPicto,.5,{delay:2,easel:{alpha:0,y:raysy},ease:Power3.easeOut}),TweenLite.to($scope.game.bonusVideoPicto,.5,{delay:2,easel:{alpha:0},ease:Power3.easeOut}),TweenLite.to(badge,1,{delay:2,easel:{alpha:0,y:posy},ease:Power3.easeOut,onStart:function(){$scope.user.score==66?($scope.stopRadio(),$timeout(function(){$scope.showCongratsMessage()},400)):$timeout(function(){$scope.showHighlightSpot(x,y,badgeid,founded)},500)},onComplete:function(){$scope.game.container.removeChild(badge)}})}})):($scope.game.inputMode=!0,$scope.showFoundPopOver())}},$scope.showCongratsMessage=function(){var posy=$scope.game.bounds.height/2,desty=posy-25;$scope.game.congratsPicto.alpha=0,$scope.game.lauriers66.alpha=0,$scope.game.congratsPicto.regX=$scope.game.congratsPicto.image.width/2,$scope.game.congratsPicto.regY=$scope.game.congratsPicto.image.height/2,$scope.game.congratsPicto.x=$scope.game.bounds.width/2,$scope.game.congratsPicto.y=desty-100,$scope.game.lauriers66.regX=$scope.game.lauriers66.image.width/2,$scope.game.lauriers66.regY=$scope.game.lauriers66.image.height/2,$scope.game.lauriers66.x=$scope.game.bounds.width/2,$scope.game.lauriers66.y=desty+125,$scope.game.lauriers66.scaleX=.5,$scope.game.sounds.loopRadio&&TweenLite.to($scope.game.sounds.loopRadio,$scope.game.tweenSpeed/2,{volume:0,ease:$scope.game.defaultEasingFunc}),$scope.playSoundId($scope.game.sounds.DEFI_GAGNE),TweenLite.to($scope.game.congratsPicto,.5,{easel:{alpha:1,y:desty},ease:Back.easeInOut}),TweenLite.to($scope.game.lauriers66,.8,{delay:.5,easel:{alpha:1,scaleX:1},ease:Elastic.easeOut,onComplete:function(){$scope.game.sparksPerClick=$scope.getRandom(42,100),$scope.addSparkles(Math.random()*$scope.game.sparksPerClick+$scope.game.sparksPerClick|0,$scope.game.bounds.width/2,$scope.game.bounds.height/2,1.1,0)},onStart:function(){TweenLite.to($scope.game.lowspot,.5,{delay:3,easel:{alpha:0},ease:Power3.easeOut}),TweenLite.to($scope.game.congratsPicto,.5,{delay:3,easel:{alpha:0,y:desty},ease:Power3.easeOut}),TweenLite.to($scope.game.lauriers66,.5,{delay:3,easel:{alpha:0},ease:Power3.easeOut,onStart:function(){$timeout(function(){$scope.getProfile()},400)}})}})},$scope.showGaragePopOver=function(){$("#garagetooltip").modal("show"),$("#inputfieldtxt").blur()},$scope.hideGaragePopOver=function(){TweenLite.to($scope.game.lowspot,.5,{easel:{alpha:0},ease:Circ.easeOut}),$("#garagetooltip").addClass("hidden")},$scope.showFoundPopOver=function(){$scope.playSoundId($scope.game.sounds.ALREADY_FOUND),$("#foundtooltip").modal("show"),$("#inputfieldtxt").blur(),$scope.game.DEBUG&&console.log("scope.showFoundPopOver")},$scope.hideFoundPopOver=function(){$scope.game.DEBUG&&console.log("scope.hideFoundPopOver"),TweenLite.to($scope.game.lowspot,.5,{easel:{alpha:0},ease:Circ.easeOut}),$("#foundtooltip").addClass("hidden")},$scope.showSavePopOver=function(){TweenLite.to($scope.game.lowspot,.5,{easel:{alpha:.6},ease:Circ.easeOut}),$("#menulink").popover("show").focus()},$scope.showScorePopOver=function(){TweenLite.to($scope.game.lowspot,.5,{easel:{alpha:.6},ease:Circ.easeOut}),$("#score").popover("show").focus()},$scope.showErrorPopOver=function(){$scope.hideInputField(),TweenLite.to($scope.game.lowspot,.5,{easel:{alpha:.6},ease:Circ.easeOut}),$("#errors").popover("show").focus()},$scope.hidePopOver=function(){TweenLite.to($scope.game.lowspot,.5,{easel:{alpha:0},ease:Circ.easeOut}),$('[data-toggle="popover"]').popover("hide"),$scope.game.inputMode=!0,$scope.showInputField(),$scope.game.scoreTooltip=!1,$scope.game.errorsTooltip=!1,$scope.game.saveTooltip=!1},$scope.highliteScore=function(){TweenLite.to("#score",$scope.game.tweenSpeed,{className:"+=btn-score-hilite",ease:$scope.game.defaultEasingFunc,onComplete:function(){TweenLite.to("#score",$scope.game.tweenSpeed,{delay:1,className:"-=btn-score-hilite",ease:$scope.game.defaultEasingFunc})}})},$scope.initRules=function(){$scope.game.DEBUG&&console.log("scope.initRules");var rules=$("#rules_slides");Hammer(rules[0]).on("swipeleft",function(e){rules.data("superslides").animate("next")}),Hammer(rules[0]).on("swiperight",function(e){rules.data("superslides").animate("prev")}),rules.superslides({animation_speed:400,animation_easing:"easeInOutExp",pagination:!1,hashchange:!1})},$scope.initCredits=function(){$("#credits").click(function(){$scope.clickSound(),$scope.game.sounds.ambianceVolume=1,$scope.game.sounds.loopAmbiance&&(TweenLite.to($scope.game.sounds.loopAmbiance,$scope.game.tweenSpeed,{volume:$scope.game.sounds.ambianceBackVolume,ease:$scope.game.defaultEasingFunc}),$scope.game.sounds.loopRadio&&TweenLite.to($scope.game.sounds.loopRadio,$scope.game.tweenSpeed,{volume:$scope.game.sounds.ambianceRadioVolume,ease:$scope.game.defaultEasingFunc})),$scope.game.sounds.loopNeon&&TweenLite.to($scope.game.sounds.loopNeon,$scope.game.tweenSpeed,{volume:$scope.game.sounds.ambianceLoopNeonVolume,ease:$scope.game.defaultEasingFunc}),TweenLite.to("#credits",$scope.game.tweenSpeed,{autoAlpha:0,ease:$scope.game.defaultEasingFunc}),$scope.game.context=="game"&&$scope.blurGarage(!1)}),$("#credits p > a").mouseover(function(){$(this).css("color","#fff");var img=$(this).siblings("span").children("a").children("img");img.attr("src","assets/img/credits/logo-"+img.attr("id")+"-on.png")}).mouseout(function(){$(this).css("color","#a8a8a8");var img=$(this).siblings("span").children("a").children("img");img.attr("src","assets/img/credits/logo-"+img.attr("id")+"-off.png")}),$("#credits span > a > img").mouseover(function(){var a=$(this).parent("a").parent("span").siblings("a");a.css("color","#fff"),$(this).attr("src","assets/img/credits/logo-"+$(this).attr("id")+"-on.png")}).mouseout(function(){var a=$(this).parent("a").parent("span").siblings("a");a.css("color","#a8a8a8"),$(this).attr("src","assets/img/credits/logo-"+$(this).attr("id")+"-off.png")}),$(".tumblr a").mouseover(function(){var img=$(this).children("img");img.attr("src","assets/img/tumblr-on.png")}).mouseout(function(){var img=$(this).children("img");img.attr("src","assets/img/tumblr-off.png")})},$scope.initPopover=function(){$("#menulink").popover({placement:"bottom",title:"",trigger:"manual",content:function(){return $("#savetooltip").html()},html:!0}),$("#score").popover({placement:"bottom",title:"",trigger:"manual",content:function(){return $("#badgetooltip").html()},html:!0}),$("#errors").popover({placement:"bottom",title:"",trigger:"manual",content:function(){return $("#errorstooltip").html()},html:!0}),$("#garagetooltip").modal({keyboard:!0,show:!1}),$("#garagetooltip").on("hide.bs.modal",function(){$scope.game.DEBUG&&console.log("garagetooltip on hide")}),$("#garagetooltip").on("hidden.bs.modal",function(){$scope.game.DEBUG&&console.log("garagetooltip hidden"),$scope.game.inputMode=!0,$scope.game.mobileDevice||$("#inputfieldtxt").focus()}),$("#foundtooltip").modal({keyboard:!0,show:!1}),$("#foundtooltip").on("hide.bs.modal",function(){$scope.game.DEBUG&&console.log("foundtooltip on hide"),$scope.game.inputMode=!0}),$("#foundtooltip").on("hidden.bs.modal",function(){$scope.game.DEBUG&&console.log("foundtooltip hidden"),$scope.game.inputMode=!0,$scope.game.mobileDevice||$scope.showInputField(!1)}),$document.keyup(function(e){e.keyCode==27&&($scope.game.scoreTooltip||$scope.game.errorsTooltip||$scope.game.saveTooltip)&&$scope.hidePopOver()}),$("body").on("click",function(e){$(e.target).data("toggle")!=="popover"&&$(e.target).parents(".popover.in").length===0&&($scope.game.scoreTooltip||$scope.game.errorsTooltip||$scope.game.saveTooltip)&&($scope.clickSound(),$scope.hidePopOver())})},$scope.initBadges=function(){$scope.game.DEBUG&&console.log("scope.initBadges");var badges=$("#badges_slides");Hammer(badges[0]).on("swipeleft",function(e){badges.data("superslides").animate("next")}),Hammer(badges[0]).on("swiperight",function(e){badges.data("superslides").animate("prev")}),badges.superslides({animation_speed:400,animation_easing:"easeInOutExp",pagination:!0,hashchange:!1,elements:{preserve:".preserve",nav:".slides-navigation",container:".slides-container",pagination:".slides-pagination"}}),$("#badges").click(function(){$scope.clickSound(),$scope.game.sounds.ambianceVolume=1,TweenLite.to($scope.game.sounds.loopAmbiance,$scope.game.tweenSpeed,{volume:$scope.game.sounds.ambianceBackVolume,ease:$scope.game.defaultEasingFunc}),$scope.game.sounds.loopRadio&&TweenLite.to($scope.game.sounds.loopRadio,$scope.game.tweenSpeed,{volume:$scope.game.sounds.ambianceRadioVolume,ease:$scope.game.defaultEasingFunc}),$scope.game.sounds.loopNeon&&TweenLite.to($scope.game.sounds.loopNeon,$scope.game.tweenSpeed,{volume:$scope.game.sounds.ambianceLoopNeonVolume,ease:$scope.game.defaultEasingFunc}),TweenLite.to("#badges",$scope.game.tweenSpeed,{autoAlpha:0,ease:$scope.game.defaultEasingFunc,onComplete:function(){$("#badges_slides").data("superslides").animate($("#badges_slides").data("superslides").size()-1),$("#badges_slides").data("superslides").animate(0)}}),$scope.game.context=="game"&&$scope.blurGarage(!1)}),$("#videoplayer").click(function(event){console.log("click :"+event.target.nodeName),$scope.clickSound(),event.target.nodeName!="videoplayer"&&event.stopPropagation(),$scope.hideVideoPlayer(),$scope.game.context=="game"&&($scope.game.sounds.loopRadioTimerID=$timeout($scope.startRadio,1e4))}),$("#videocontainer").fitVids(),$scope.game.videoIframe=$("#videocontainer iframe"),window.addEventListener?window.addEventListener("message",$scope.onVpMessageReceived,!1):window.attachEvent("onmessage",$scope.onVpMessageReceived,!1)},$scope.onVpMessageReceived=function(e){if($scope.IsJsonString(e.data)){var data=JSON.parse(e.data);switch(data.event){case"ready":$scope.onVideoReady();break;case"playProgress":$scope.onPlayProgress(data.data);break;case"pause":$scope.onPause();break;case"finish":$scope.onFinish()}}},$scope.IsJsonString=function(str){try{JSON.parse(str)}catch(e){return!1}return!0},$scope.videoPost=function(action,value){var data={method:action};value&&(data.value=value);var url=$scope.game.videoIframe.attr("src").split("?")[0];$scope.game.videoIframe[0].contentWindow.postMessage(JSON.stringify(data),url)},$scope.onVideoReady=function(){$scope.game.DEBUG&&console.log("$scope.onVideoReady : ready"),$scope.videoPost("addEventListener","pause"),$scope.videoPost("addEventListener","finish"),$scope.videoPost("play")},$scope.onPause=function(){$scope.game.DEBUG&&console.log("$scope.onPause")},$scope.onFinish=function(){$scope.game.DEBUG&&console.log("$scope.onFinish")},$scope.onPlayProgress=function(data){},$scope.showVideoPlayer=function(badgeid,videoid){$("#videoplayer").css("z-index","141"),TweenLite.to("#videoplayer",$scope.game.tweenSpeed,{autoAlpha:1,ease:$scope.game.defaultEasingFunc,onComplete:function(){$scope.game.videoIframe.attr("id",badgeid),$scope.game.videoIframe.attr("src","https://player.vimeo.com/video/"+videoid+"?api=1&player_id="+badgeid),$("#videocontainer").fitVids(),$scope.cancelAmbiance()}}),$analytics.eventTrack("click-badges",{category:"video-player",label:badgeid})},$scope.hideVideoPlayer=function(){TweenLite.to("#videoplayer",$scope.game.tweenSpeed,{autoAlpha:0,ease:$scope.game.defaultEasingFunc,onComplete:function(){$scope.videoPost("pause"),$scope.game.videoIframe.attr("src",""),$("#videoplayer").css("z-index","-141")}})},$scope.updateBadgesPage=function(badgeid,videoid,pos){$scope.game.DEBUG&&console.log("$scope.updateBadgesPage id:"+badgeid+" / videoid:"+videoid);var img1=new Image;img1.src="assets/img/badges/off/"+badgeid+".png";var img2=new Image;img2.src="assets/img/badges/roll/"+badgeid+".png";var img=$("#b"+pos);img.attr("src","assets/img/badges/off/"+badgeid+".png").mouseover(function(){$(this).attr("src","assets/img/badges/roll/"+badgeid+".png")}).mouseout(function(){$(this).attr("src","assets/img/badges/off/"+badgeid+".png")}).click(function(e){e.stopPropagation(),$scope.clickSound(),$scope.showVideoPlayer(badgeid,videoid)})},$scope.resetBadgesPage=function(){for(var pos=0;pos<66;pos++){var img=$("#b"+pos);img.attr("src","assets/img/badges/unknownShield.png").unbind("mouseover mouseout click")}},$scope.isScoreNull=function(){return $scope.user.score==0?!0:!1},$scope.isLogged=function(){return $scope.user.logged},$scope.connectGame=function(context,action){$scope.game.DEBUG&&console.log("scope.connectGame "+action),$scope.clickSound();if(action=="load")$analytics.eventTrack("click-bouton",{category:context,label:"reprendre-partie"}),$scope.view.loadGame=!0,$scope.view.menu2ReturnButtonText=$scope.translation.BTN_BACKTOMENU,$scope.view.menu2TitleText=$scope.translation.MENU2_TITLE1,$scope.view.menu2SubTitleText=$scope.translation.MENU2_CONTENT1,$scope.view.menu2SubmitButtonText=$scope.translation.BTN_CONNECT;else{$analytics.eventTrack("click-bouton",{category:context,label:"sauver-partie"}),$scope.view.loadGame=!1,$scope.view.menu2ReturnButtonText=$scope.translation.BTN_BACKTOMENU,$scope.view.menu2TitleText=$scope.translation.MENU2_TITLE2,$scope.view.menu2SubTitleText=$scope.translation.MENU2_CONTENT2,$scope.view.menu2SubmitButtonText=$scope.translation.BTN_CONNECT;if($scope.user.logged){$scope.saveGameInDBLogged($scope);return}}var tl=new TimelineLite;tl.to("#menu2",0,{autoAlpha:1}),tl.to("#menu2",0,{left:$(window).width()}),tl.to("#menu2",$scope.game.tweenSpeed,{left:0,ease:$scope.game.defaultEasingFunc}),tl.play(),TweenLite.to($scope.view.currentPanel,$scope.game.tweenSpeed,{left:"-"+$(window).width(),ease:$scope.game.defaultEasingFunc,onComplete:function(){$scope.view.currentPanel.css("visibility","hidden"),$scope.view.previousPanel=$scope.view.currentPanel,$scope.view.currentPanel=$("#menu2")}})},$scope.backToPrevious=function(panel){$scope.game.DEBUG&&console.log("scope.backToPrevious "+panel),$scope.clickSound();switch(panel){case"#saved":$scope.view.previousPanel=$("#mainmenu");break;case"#saved2":$scope.view.previousPanel=$("#mainmenu");break;case"#menu2":$scope.view.loadGame?$scope.view.previousPanel=$("#menu1"):$scope.view.previousPanel=$("#mainmenu");break;case"#register":$scope.view.previousPanel=$("#menu2");break;case"#lostpassword":$scope.view.previousPanel=$("#menu2");break;case"#registered":$scope.view.loadGame?$scope.view.previousPanel=$("#menu1"):$scope.view.previousPanel=$("#mainmenu");break;case"#emailsent":$scope.view.loadGame?$scope.view.previousPanel=$("#menu1"):$scope.view.previousPanel=$("#mainmenu");break;case"#quitconfirm":$scope.view.previousPanel=$("#mainmenu")}$scope.view.previousPanel.css("visibility","visible"),TweenLite.to($scope.view.previousPanel,$scope.game.tweenSpeed,{left:0,ease:$scope.game.defaultEasingFunc}),TweenLite.to(panel,$scope.game.tweenSpeed,{left:$(window).width(),ease:$scope.game.defaultEasingFunc,onComplete:function(){$(panel).css("visibility","hidden").css("left",0)}}),$scope.view.currentPanel=$scope.view.previousPanel,$scope.view.previousPanel=undefined},$scope.openWaitWindow=function(){TweenLite.to("#wait",$scope.game.tweenSpeed*2,{autoAlpha:1,ease:$scope.game.defaultEasingFunc})},$scope.closeWaitWindow=function(){TweenLite.to("#wait",$scope.game.tweenSpeed,{autoAlpha:0,ease:$scope.game.defaultEasingFunc})},$scope.authError=function(){var tl=new TimelineLite;tl.to("#autherror",0,{autoAlpha:1}),tl.to("#autherror",0,{left:$(window).width()}),tl.to("#autherror",$scope.game.tweenSpeed,{left:0,ease:$scope.game.defaultEasingFunc}),tl.play(),TweenLite.to($scope.view.currentPanel,$scope.game.tweenSpeed,{left:"-"+$(window).width(),ease:$scope.game.defaultEasingFunc,onComplete:function(){$scope.view.currentPanel.css("visibility","hidden"),$scope.view.previousPanel=$scope.view.currentPanel,$scope.view.currentPanel=$("#autherror")}})},$scope.gotoRules=function(context){$scope.game.DEBUG&&console.log("scope.gotoRules "+context);var tl=new TimelineLite;$scope.clickSound(),$analytics.eventTrack("click-bouton",{category:context,label:"regles"}),$scope.view.rulesReturnButtonText=$scope.translation.BTN_BACKTOMENU,$("#rules_slides").superslides("current")!=0?($document.one("animated.slides",function(){tl.to("#rules",0,{autoAlpha:1}),tl.to("#rules",0,{left:$(window).width()}),tl.to("#rules",$scope.game.tweenSpeed,{left:0,ease:$scope.game.defaultEasingFunc}),tl.play(),TweenLite.to($scope.view.currentPanel,$scope.game.tweenSpeed,{left:"-"+$(window).width(),ease:$scope.game.defaultEasingFunc,onComplete:function(){$scope.view.currentPanel.css("visibility","hidden"),$scope.view.previousPanel=$scope.view.currentPanel,$scope.view.currentPanel=$("#rules")}})}),$("#rules_slides").superslides("animate",0)):(tl.to("#rules",0,{autoAlpha:1}),tl.to("#rules",0,{left:$(window).width()}),tl.to("#rules",$scope.game.tweenSpeed,{left:0,ease:$scope.game.defaultEasingFunc}),tl.play(),TweenLite.to($scope.view.currentPanel,$scope.game.tweenSpeed,{left:"-"+$(window).width(),ease:$scope.game.defaultEasingFunc,onComplete:function(){$scope.view.currentPanel.css("visibility","hidden"),$scope.view.previousPanel=$scope.view.currentPanel,$scope.view.currentPanel=$("#rules")}}))},$scope.closeRules=function(startGame){$scope.game.DEBUG&&console.log("scope.closeRules"),$scope.clickSound(),$scope.view.previousPanel.css("visibility","visible"),TweenLite.to($scope.view.previousPanel,$scope.game.tweenSpeed,{left:0,ease:$scope.game.defaultEasingFunc}),TweenLite.to("#rules",$scope.game.tweenSpeed,{left:$(window).width(),ease:$scope.game.defaultEasingFunc,onComplete:function(){$("#rules").css("visibility","hidden").css("left",0),$("#rules_slides").data("superslides").animate($("#rules_slides").data("superslides").size()-1),$("#rules_slides").data("superslides").animate(0),startGame&&$scope.newGameFromRules()}}),$scope.view.currentPanel=$scope.view.previousPanel,$scope.view.previousPanel=undefined},$scope.gotoCredits=function(){if($scope.view.currentPanel==$("#mainmenu"))return;$analytics.eventTrack("click-bouton",{category:"footer",label:"credits"}),$scope.game.DEBUG&&console.log("scope.gotoCredits"),$scope.playSoundId($scope.game.sounds.MENU),$scope.game.sounds.ambianceVolume=0,$scope.game.sounds.loopAmbiance&&($scope.game.sounds.loopAmbiance&&TweenLite.to($scope.game.sounds.loopAmbiance,$scope.game.tweenSpeed,{volume:.1,ease:$scope.game.defaultEasingFunc}),$scope.game.sounds.loopRadio&&TweenLite.to($scope.game.sounds.loopRadio,$scope.game.tweenSpeed,{volume:.2,ease:$scope.game.defaultEasingFunc})),$scope.game.sounds.loopNeon&&TweenLite.to($scope.game.sounds.loopNeon,$scope.game.tweenSpeed,{volume:.2,ease:$scope.game.defaultEasingFunc}),$scope.game.context=="game"?($scope.blurGarage(!0),TweenLite.to("#credits",$scope.game.tweenSpeed,{autoAlpha:1,delay:$scope.game.tweenSpeed,ease:$scope.game.defaultEasingFunc}),$scope.hideInputField()):TweenLite.to("#credits",$scope.game.tweenSpeed,{autoAlpha:1,ease:$scope.game.defaultEasingFunc})},$scope.closeCredits=function(){$scope.game.sounds.ambianceVolume=1,$scope.game.sounds.loopAmbiance&&(TweenLite.to($scope.game.sounds.loopAmbiance,$scope.game.tweenSpeed,{volume:$scope.game.sounds.ambianceBackVolume,ease:$scope.game.defaultEasingFunc}),TweenLite.to($scope.game.sounds.loopRadio,$scope.game.tweenSpeed,{volume:$scope.game.sounds.ambianceRadioVolume,ease:$scope.game.defaultEasingFunc}),TweenLite.to($scope.game.sounds.loopNeon,$scope.game.tweenSpeed,{volume:$scope.game.sounds.ambianceLoopNeonVolume,ease:$scope.game.defaultEasingFunc})),TweenLite.to("#credits",$scope.game.tweenSpeed,{autoAlpha:0,ease:$scope.game.defaultEasingFunc}),$scope.game.context=="game"&&$scope.blurGarage(!1)},$scope.gotoBadges=function(){$scope.game.DEBUG&&console.log("scope.gotoBadges"),$scope.clickSound(),$scope.game.sounds.ambianceVolume=0,($scope.game.scoreTooltip||$scope.game.errorsTooltip||$scope.game.saveTooltip)&&$scope.hidePopOver(),$document.one("animated.slides",function(){$("body").css("cursor","default"),$scope.playSoundId($scope.game.sounds.MENU),$scope.game.context=="game"?(TweenLite.to($scope.game.sounds.loopAmbiance,$scope.game.tweenSpeed,{volume:0,ease:$scope.game.defaultEasingFunc}),$scope.game.sounds.loopRadio&&TweenLite.to($scope.game.sounds.loopRadio,$scope.game.tweenSpeed,{volume:.2,ease:$scope.game.defaultEasingFunc}),$scope.blurGarage(!0),TweenLite.to("#badges",$scope.game.tweenSpeed,{autoAlpha:1,delay:$scope.game.tweenSpeed,ease:$scope.game.defaultEasingFunc}),$scope.hideInputField()):($scope.game.sounds.loopNeon&&TweenLite.to($scope.game.sounds.loopNeon,$scope.game.tweenSpeed,{volume:.2,ease:$scope.game.defaultEasingFunc}),TweenLite.to("#badges",$scope.game.tweenSpeed,{autoAlpha:1,ease:$scope.game.defaultEasingFunc}))}),$("body").css("cursor","progress");if($scope.user.score>6){var page=Math.floor(($scope.user.score+5)/6)-1;$scope.game.DEBUG&&console.log("scope.gotoBadges goto page "+page),page==10?($document.one("animated.slides",function(){$scope.game.DEBUG&&console.log("scope.gotoBadges goto page 10 now !"),$("#badges_slides").data("superslides").animate(10)}),$("#badges_slides").data("superslides").animate(9)):$("#badges_slides").data("superslides").animate(page)}else $("#badges_slides").data("superslides").animate(0)},$scope.gotoRegister=function(){$scope.game.DEBUG&&console.log("scope.gotoRegister"),$scope.clickSound(),$analytics.eventTrack("click-bouton",{category:"sauver-partie",label:"creer-compte"});var tl=new TimelineLite;tl.to("#register",0,{autoAlpha:1}),tl.to("#register",0,{left:$(window).width()}),tl.to("#register",$scope.game.tweenSpeed,{left:0,ease:$scope.game.defaultEasingFunc}),tl.play(),TweenLite.to($scope.view.currentPanel,$scope.game.tweenSpeed,{left:"-"+$(window).width(),ease:$scope.game.defaultEasingFunc,onComplete:function(){$scope.view.currentPanel.css("visibility","hidden"),$scope.view.previousPanel=$scope.view.currentPanel,$scope.view.currentPanel=$("#register")}})},$scope.gotoLostPassword=function(){$scope.game.DEBUG&&console.log("scope.gotoLostPassword"),$scope.clickSound(),$scope.view.loadGame?$analytics.eventTrack("click-bouton",{category:"reprendre-partie",label:"lost-password"}):$analytics.eventTrack("click-bouton",{category:"sauver-partie",label:"lost-password"});var tl=new TimelineLite;tl.to("#lostpassword",0,{autoAlpha:1}),tl.to("#lostpassword",0,{left:$(window).width()}),tl.to("#lostpassword",$scope.game.tweenSpeed,{left:0,ease:$scope.game.defaultEasingFunc}),tl.play(),TweenLite.to($scope.view.currentPanel,$scope.game.tweenSpeed,{left:"-"+$(window).width(),ease:$scope.game.defaultEasingFunc,onComplete:function(){$scope.view.currentPanel.css("visibility","hidden"),$scope.view.previousPanel=$scope.view.currentPanel,$scope.view.currentPanel=$("#lostpassword")}})},$scope.gotoMainMenu=function(){$scope.clickSound(),$scope.playSoundId($scope.game.sounds.MENU),$scope.game.sounds.ambianceVolume=0,TweenLite.to($scope.game.sounds.loopAmbiance,$scope.game.tweenSpeed,{volume:.1,ease:$scope.game.defaultEasingFunc}),$scope.game.sounds.loopRadio&&TweenLite.to($scope.game.sounds.loopRadio,$scope.game.tweenSpeed,{volume:.2,ease:$scope.game.defaultEasingFunc}),$scope.game.DEBUG&&console.log("scope.gotoMainMenu"),$scope.blurGarage(!0),TweenLite.to("#mainmenu",0,{left:0}),TweenLite.to("#mainmenu",$scope.game.tweenSpeed,{autoAlpha:1,delay:$scope.game.tweenSpeed,ease:$scope.game.defaultEasingFunc}),$scope.hideInputField(),$scope.view.currentPanel=$("#mainmenu")},$scope.closeMainMenu=function(quit){$scope.game.sounds.ambianceVolume=1,TweenLite.to($scope.game.sounds.loopAmbiance,$scope.game.tweenSpeed
,{volume:$scope.game.sounds.ambianceBackVolume,ease:$scope.game.defaultEasingFunc}),$scope.game.sounds.loopRadio&&TweenLite.to($scope.game.sounds.loopRadio,$scope.game.tweenSpeed,{volume:$scope.game.sounds.ambianceRadioVolume,ease:$scope.game.defaultEasingFunc}),$scope.game.DEBUG&&console.log("scope.closeMainMenu"),TweenLite.to("#mainmenu",$scope.game.tweenSpeed,{autoAlpha:0,ease:$scope.game.defaultEasingFunc}),$scope.blurGarage(!1),quit&&$timeout(function(){$scope.getProfile()},$scope.game.tweenSpeed*1200)},$scope.createAccount=function(){$scope.game.DEBUG&&console.log("scope.createAccount "+$scope.user.email),$scope.clickSound(),$.post("scripts/register.php",{name:$scope.user.name,email:$scope.user.email,password:$scope.user.password,password2:$scope.user.password2,lang:$scope.view.lang},$scope.registerCallback,"xml")},$scope.registerCallback=function(xml){$scope.game.DEBUG&&console.log("scope.registerCallback");var result=$(xml).find("result"),error=$(xml).find("error");console.log("result : "+result.text()+" / error : "+error.text());if(Math.abs(result.text())==1){var tl=new TimelineLite;$scope.playSoundId($scope.game.sounds.BANJO),tl.to("#registered",0,{autoAlpha:1}),tl.to("#registered",0,{left:$(window).width()}),tl.to("#registered",$scope.game.tweenSpeed,{left:0,ease:$scope.game.defaultEasingFunc}),tl.play(),TweenLite.to($scope.view.currentPanel,$scope.game.tweenSpeed,{left:"-"+$(window).width(),ease:$scope.game.defaultEasingFunc,onComplete:function(){$scope.view.currentPanel.css("visibility","hidden"),$scope.view.previousPanel=$scope.view.currentPanel,$scope.view.currentPanel=$("#registered"),$scope.user.logged=!0}})}else $scope.view.authErrorMsg=error.text(),$scope.user.email="",$scope.user.name="",$scope.user.password=$scope.user.password2="",$scope.$apply(),$scope.authError()},$scope.initFBConnect=function(){(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(d.getElementById(id))return;js=d.createElement(s),js.id=id,js.src="//connect.facebook.net/en_US/all.js",fjs.parentNode.insertBefore(js,fjs)})(document,"script","facebook-jssdk"),window.fbAsyncInit=function(){FB.init({appId:"639197716221251",channelURL:"",status:!0,cookie:!0,oauth:!0,xfbml:!0})}},$scope.FBLogin=function(){$scope.clickSound(),$scope.openWaitWindow(),$scope.view.loadGame?$analytics.eventTrack("click-bouton",{category:"reprendre-partie",label:"facebook"}):$analytics.eventTrack("click-bouton",{category:"sauver-partie",label:"facebook"}),FB.login(function(response){response.authResponse?(console.log("Welcome!  Fetching your information.... "),FB.api("/me?fields=email,picture.height(100).width(100).type(large),first_name",function(info){$scope.FBLoginCallback(response,info)})):($scope.closeWaitWindow(),$scope.authError(),$scope.view.loadGame?$analytics.eventTrack("auth-error",{category:"reprendre-partie",label:"facebook"}):$analytics.eventTrack("auth-error",{category:"sauver-partie",label:"facebook"}))},{scope:"email"})},$scope.FBLoginCallback=function(response,info){$scope.closeWaitWindow();if(response.authResponse){var accessToken=response.authResponse.accessToken;console.log("Good to see you, "+info.first_name+"."),$scope.user.name=info.first_name,$scope.user.email=info.email,$scope.user.picture=info.picture.data.url,$scope.user.type="facebook",$scope.$apply(),$("#avatar").attr("src",$scope.user.picture).attr("alt",$scope.user.name),$("#avatarLogged").attr("src",$scope.user.picture).attr("alt",$scope.user.name),$("#avatarSaved").attr("src",$scope.user.picture).attr("alt",$scope.user.name);var tl=new TimelineLite,panel;$scope.view.loadGame?(panel="#logged",$analytics.eventTrack("auth-success",{category:"reprendre-partie",label:"facebook"}),$scope.loadGameFromDB($scope)):(panel="#saved",$analytics.eventTrack("auth-success",{category:"sauver-partie",label:"facebook"}),$scope.saveGameInDB($scope)),tl.to(panel,0,{autoAlpha:1}),tl.to(panel,0,{left:$(window).width()}),tl.to(panel,$scope.game.tweenSpeed,{left:0,ease:$scope.game.defaultEasingFunc}),tl.play(),TweenLite.to($scope.view.currentPanel,$scope.game.tweenSpeed,{left:"-"+$(window).width(),ease:$scope.game.defaultEasingFunc,onComplete:function(){$scope.playSoundId($scope.game.sounds.BANJO),$scope.view.currentPanel.css("visibility","hidden"),$scope.view.previousPanel=$scope.view.currentPanel,$scope.view.currentPanel=$(panel),$scope.user.logged=!0}})}},$scope.getTwitterCred=function(){$scope.game.DEBUG&&console.log("scope.getTwitterCred"),$.post("scripts/getTwitterCred.php",{},$scope.loginTwitter,"xml")},$scope.getGoogleCred=function(authResult){authResult["g-oauth-window"]&&(authResult.access_token?(console.log("GPLUS Autorisation russie : "+authResult.id_token),$scope.loginGoogle()):authResult.error&&(console.log("GPLUS error : "+authResult.error),$scope.closeWaitWindow(),$scope.authError()))},$scope.getUserName=function(){return $scope.user.name?" "+$scope.user.name:""},$scope.lostPassword=function(){$scope.clickSound();var tl=new TimelineLite;tl.to("#emailsent",0,{autoAlpha:1}),tl.to("#emailsent",0,{left:$(window).width()}),tl.to("#emailsent",$scope.game.tweenSpeed,{left:0,ease:$scope.game.defaultEasingFunc}),tl.play(),TweenLite.to($scope.view.currentPanel,$scope.game.tweenSpeed,{left:"-"+$(window).width(),ease:$scope.game.defaultEasingFunc,onComplete:function(){$scope.view.currentPanel.css("visibility","hidden"),$scope.view.previousPanel=$scope.view.currentPanel,$scope.view.currentPanel=$("#emailsent"),$scope.user.email=""}})},$scope.TwitterLogin=function(){$scope.clickSound(),$scope.openWaitWindow(),$scope.view.loadGame?$analytics.eventTrack("click-bouton",{category:"reprendre-partie",label:"twitter"}):$analytics.eventTrack("click-bouton",{category:"sauver-partie",label:"twitter"}),$scope.popWindow=window.open("/scripts/redirect.php?action=auth","authentication","height=800,width=500")},$scope.GoogleLogin=function(){return},$scope.emailLogin=function(){$scope.game.DEBUG&&console.log("scope.emailLogin "+$scope.user.email),$scope.clickSound(),$scope.openWaitWindow(),$scope.view.loadGame?$analytics.eventTrack("click-bouton",{category:"reprendre-partie",label:"email"}):$analytics.eventTrack("click-bouton",{category:"sauver-partie",label:"email"}),$.post("scripts/login.php",{email:$scope.user.email,password:$scope.user.password},$scope.loginCallback,"xml")},$scope.loginCallback=function(xml){$scope.game.DEBUG&&console.log("scope.loginCallback");var result=$(xml).find("result"),id=$(xml).find("id"),score=$(xml).find("score"),error=$(xml).find("error"),errors=$(xml).find("errors"),answers=$(xml).find("answers"),badges=$(xml).find("badges"),pins=$(xml).find("pins");$scope.closeWaitWindow();if(Math.abs(result.text())==1){console.log("result : "+result.text()+" / score : "+score.text()+" / errors : "+errors.text()+" / answers : "+answers.text()+" / badges : "+badges.text()),$scope.view.loadGame?(panel="#logged",$analytics.eventTrack("auth-success",{category:"reprendre-partie",label:"email"}),$scope.loadDBCallback(xml)):(panel="#saved",$analytics.eventTrack("auth-success",{category:"sauver-partie",label:"email"}),$scope.saveGameInDB($scope)),$scope.user.name=$(xml).find("name").text(),$scope.user.email=$(xml).find("email").text(),$scope.$apply();var tl=new TimelineLite;tl.to(panel,0,{autoAlpha:1}),tl.to(panel,0,{left:$(window).width()}),tl.to(panel,$scope.game.tweenSpeed,{left:0,ease:$scope.game.defaultEasingFunc}),tl.play(),TweenLite.to($scope.view.currentPanel,$scope.game.tweenSpeed,{left:"-"+$(window).width(),ease:$scope.game.defaultEasingFunc,onComplete:function(){$scope.playSoundId($scope.game.sounds.BANJO),$scope.view.currentPanel.css("visibility","hidden"),$scope.view.previousPanel=$scope.view.currentPanel,$scope.view.currentPanel=$(panel),$scope.user.logged=!0}})}else console.log("result : "+result.text()+" / error : "+error.text()),$scope.authError(),$scope.view.loadGame?$analytics.eventTrack("auth-error",{category:"reprendre-partie",label:"email"}):$analytics.eventTrack("auth-error",{category:"sauver-partie",label:"email"})},$scope.globalShare=function(social){var i=$('meta[property="og:title"]').attr("content"),c=encodeURI($('meta[property="og:description"]').attr("content")),s=encodeURI($('meta[property="og:image"]').attr("content")),l=encodeURI(location.href),n={height:$(window).height()/2,width:$(window).width()/2},obj={};$scope.clickSound(),$scope.game.DEBUG&&console.log("scope.globalShare "+social);switch(social){case"facebook":$analytics.eventTrack("global-share",{category:"footer",label:"facebook"}),obj.url="//www.facebook.com/sharer.php?s=100&p[title]="+i+"&p[url]="+l+"&p[images][0]="+s+"&p[summary]="+c,obj.height=300,obj.width=600;break;case"twitter":$analytics.eventTrack("global-share",{category:"footer",label:"twitter"}),obj.url="//twitter.com/intent/tweet?text="+c+"&url="+l,obj.height=300,obj.width=700;break;case"google":$analytics.eventTrack("global-share",{category:"footer",label:"google-plus"}),obj.url="//plus.google.com/share?url="+l,obj.height=320,obj.width=700;break;case"pin":$analytics.eventTrack("global-share",{category:"footer",label:"pinterest"}),obj.url="//pinterest.com/pin/create/button/?url="+l+"&media="+s+"&description="+c,obj.height=540,obj.width=700}window.open(obj.url,"shareWindow","height="+obj.height+",width="+obj.width+",top="+(n.height-obj.height/2)+",left="+n.width)},$scope.scoreShare=function(social){var i=$('meta[property="og:title"]').attr("content"),c=$scope.view.profiletxt,l=encodeURI("http://www.popcorngarage.com/"),n={height:$(window).height()/2,width:$(window).width()/2},obj={};$scope.clickSound(),$scope.game.DEBUG&&console.log("scope.scoreShare "+social);switch(social){case"facebook":$scope.FBShareOp(i,c,encodeURI($scope.view.profileShareImgFB),l);return;case"twitter":$scope.popWindow=window.open("/scripts/redirect.php?action=share","authentication","height=800,width=500");return;case"google":var url="url="+encodeURI("http://www.popcorngarage.com/gplus/?id="+$scope.view.neonid);obj.url="https://plus.google.com/share?"+url,obj.height=320,obj.width=700;break;case"pin":obj.url="//pinterest.com/pin/create/button/?url="+l+"&media="+encodeURI($scope.view.profileShareImgPin)+"&description="+c+" http://www.popcorngarage.com/",$scope.game.DEBUG&&console.log("scope.globalShare "+obj.url),obj.height=540,obj.width=700}window.open(obj.url,"shareWindow","height="+obj.height+",width="+obj.width+",top="+(n.height-obj.height/2)+",left="+n.width)},$scope.FBShareOp=function(product_name,description,share_image,share_url){var share_capt="Pop-Corn Garage";FB.ui({method:"feed",name:product_name,link:share_url,picture:share_image,caption:share_capt,description:description,display:"popup"},function(response){})},$scope.TwitterShareOp=function(){$scope.game.DEBUG&&console.log("scope.TwitterShareOp "+$scope.view.profiletxt);var msg=$scope.translation.SHARE_TWITTER1+$scope.user.score+$scope.translation.SHARE_TWITTER2;$scope.game.DEBUG&&console.log("scope.TwitterShareOp msg :"+msg),$.post("scripts/postTwitterUpdate.php",{msg:msg,picture:$scope.view.profileShareImgTwitter},$scope.TwitterShareCallback,"json")},$scope.TwitterShareCallback=function(xml){$scope.game.DEBUG&&console.log("scope.TwitterShareCallback "+xml)},$scope.lookupMovies=function(){$scope.game.DEBUG&&console.log("scope.lookupMovies : "+$scope.movie.title+" / "+$scope.view.lang);if($scope.movie.title.replace(/\s/g,"")==""){$scope.game.DEBUG&&console.log("scope.lookupMovies : EMPTY");return}if($scope.movie.title.indexOf("score=")>=0){var newscore=$scope.movie.title.substr($scope.movie.title.indexOf("=")+1);$scope.user.score=0,$scope.user.score+=Math.round(newscore),$scope.view.score=newscore;return}$("body").css("cursor","progress"),$timeout(function(){$scope.hideInputField(),$("#inputfieldtxt").blur(),$.post("scripts/lookup.php",{title:$scope.movie.title,lang:$scope.view.lang},$scope.lookupMoviesCallback,"xml")},0)},$scope.lookupMoviesCallback=function(xml){$scope.game.DEBUG&&console.log("scope.lookupMoviesCallback"),$("body").css("cursor","default");var result=$(xml).find("result"),error=$(xml).find("error"),movie=$(xml).find("movie"),id=$(xml).find("id"),xpos=$(xml).find("xpos"),ypos=$(xml).find("ypos"),badgeid=$(xml).find("badgeid"),videoid=$(xml).find("videoid");console.log("result : "+result.text()+" / id : "+id.text()+" / badgeid : "+badgeid.text()+" / videoid : "+videoid.text());if(result.text()==1){var founded=!1;if($scope.game.foundedMoviesIdx.indexOf(badgeid.text())==-1){founded=!0,$scope.user.score=$scope.user.score+1,$scope.user.score==1?$scope.game.scoreTooltip=!0:$scope.game.scoreTooltip=!1,$scope.user.score==2?$scope.game.garageTooltip=!0:$scope.game.garageTooltip=!1;var mod=$scope.user.score%10;$scope.user.score>0&&mod==0?$scope.game.saveTooltip=!0:$scope.game.saveTooltip=!1,$scope.highliteScore(),$scope.user.score<10?$scope.view.score="0"+$scope.user.score:$scope.view.score=$scope.user.score,$scope.game.foundedMoviesIdx.push(badgeid.text()),$scope.user.answers=$scope.game.foundedMoviesIdx,console.log("score : "+$scope.user.score),$scope.user.badges.push(badgeid.text()),$scope.updateBadgesPage(badgeid.text(),videoid.text(),$scope.user.score-1),$scope.user.pins.push({x:Math.abs(xpos.text()),y:Math.abs(ypos.text())}),$analytics.eventTrack("lookup-movies",{category:"found",label:movie.text()})}else $analytics.eventTrack("lookup-movies",{category:"already-found",label:movie.text()});$scope.showBadgeDiscovered(xpos.text(),ypos.text(),badgeid.text(),founded)}else $scope.user.errors+=0,$analytics.eventTrack("lookup-movies",{category:"failed",label:error.text()}),$scope.user.errors==1?$scope.game.errorsTooltip=!0:$scope.game.errorsTooltip=!1,$scope.errorAmbiance(),TweenLite.to("#error"+$scope.user.errors,1,{color:"#ffffff",ease:$scope.game.defaultEasingFunc,onComplete:function(){$("#error"+$scope.user.errors).removeClass("error-off")}}),TweenLite.to("#inputfieldtxt",1,{delay:.5,color:"#ffffff",ease:$scope.game.defaultEasingFunc,onComplete:function(){$scope.game.errorsTooltip||$scope.showInputField(!0)}}),$scope.user.errors==3?$timeout(function(){$scope.getProfile()},$scope.game.tweenSpeed*1400):$scope.game.sounds.loopRadioTimerID=$timeout($scope.startRadio,1e4)},$scope.getProfile=function(){$.post("scripts/getprofile.php",{score:$scope.user.score,lang:$scope.view.lang},$scope.lightDownGarage,"xml")},$scope.lightDownGarage=function(xml){var result=$(xml).find("result"),texte=$(xml).find("texte"),neonid=$(xml).find("neonid");$scope.game.DEBUG&&console.log("lightDownGarage neonid:"+texte.text()),$scope.view.profiletxt=texte.text(),$scope.view.profileShareImgFB="http://www.popcorngarage.com/assets/img/share/facebook/"+neonid.text()+".jpg",$scope.view.profileShareImgTwitter="../assets/img/share/twitter/"+neonid.text()+".jpg",$scope.view.profileShareImgGplus="http://www.popcorngarage.com/assets/img/share/gplus/"+neonid.text()+".jpg",$scope.view.profileShareImgPin="http://www.popcorngarage.com/assets/img/share/pinterest/"+neonid.text()+".jpg",$scope.view.neonid=neonid.text(),$scope.$digest(),$("#inputfieldtxt").val("");var layersIdx=[15,17,19],img1=new Image;img1.src="assets/img/neon/"+neonid.text()+"01.png";var img2=new Image;img2.src="assets/img/neon/"+neonid.text()+"02.png";if(neonid.text()=="futurfr"||neonid.text()=="futuren"||neonid.text()=="ragingbull"){var img3=new Image;img3.src="assets/img/neon/"+neonid.text()+"03.png"}if(neonid.text()=="ragingbull"){var img4=new Image;img4.src="assets/img/neon/"+neonid.text()+"04.png"}img1.onload=function(evt){$scope.cancelAmbiance();var tl=new TimelineLite,layers=$scope.game.layers;tl.to(layers[15],0,{easel:{alpha:0},ease:Quad.easeOut,overwrite:"all"}),tl.to(layers[16],0,{easel:{alpha:0},ease:Quad.easeOut,overwrite:"all"}),tl.to(layers[17],0,{easel:{alpha:0},ease:Quad.easeOut,overwrite:"all"}),tl.to(layers[18],0,{easel:{alpha:0},ease:Quad.easeOut,overwrite:"all"}),tl.to(layers[19],0,{easel:{alpha:0},ease:Quad.easeOut,overwrite:"all"}),tl.to(layers[20],0,{easel:{alpha:0},ease:Quad.easeOut,overwrite:"all"}),tl.to(layers[10],$scope.game.tweenSpeed,{easel:{alpha:1},ease:Quad.easeOut}),tl.to(layers[11],$scope.game.tweenSpeed,{delay:$scope.game.tweenSpeed/3,easel:{alpha:1},ease:Quad.easeOut}),tl.to(layers[12],$scope.game.tweenSpeed/2,{easel:{alpha:1},ease:Quad.easeOut}),tl.to(layers[13],$scope.game.tweenSpeed/2,{easel:{alpha:1},ease:Quad.easeOut}),tl.to(layers[14],$scope.game.tweenSpeed/2,{easel:{alpha:1},ease:Quad.easeOut,onComplete:function(){$scope.endTitle(neonid.text()),$scope.game.context="end"}}),tl.play(),$scope.stopAmbianceSound(),$scope.stopRadio(),$scope.playSoundId($scope.game.sounds.END),TweenLite.to("#main-logo",$scope.game.tweenSpeed,{opacity:0,ease:Circ.easeOut}),TweenLite.to("#inputfield",$scope.game.tweenSpeed,{opacity:0,ease:Circ.easeOut}),TweenLite.to("#header",$scope.game.tweenSpeed,{opacity:0,ease:Circ.easeOut}),$("#garage").removeClass("bg-garage")}},$scope.endTitle=function(neonid){$scope.user.score==66?($scope.game.FPS=24,$scope.game.endTitle=new $window.lib.TheEnd,$scope.game.container.addChild($scope.game.endTitle)):$scope.closeGarage()},$scope.animateProfileNeon=function(neonid){var max=2,volume=1;$scope.game.sounds.ambianceVolume==0&&(volume=0),$scope.game.neonIdx++;if(neonid=="futurfr"||neonid=="futuren")max=3;neonid=="ragingbull"&&(max=4),$scope.game.neonIdx>max&&($scope.game.neonIdx=1),$scope.game.neonIdx==2?neonid=="futurfr"||neonid=="futuren"?$scope.playSoundId($scope.game.sounds.NEON_OFF,volume):$scope.playSoundId($scope.game.sounds.NEON_ON,.3*volume):$scope.game.neonIdx!=3||neonid!="futurfr"&&neonid!="futuren"?$scope.game.neonIdx==4&&neonid=="ragingbull"?$scope.playSoundId($scope.game.sounds.NEON_ON,.3*volume):$scope.playSoundId($scope.game.sounds.NEON_OFF,volume):$scope.playSoundId($scope.game.sounds.NEON_ON,.3*volume),$(".profile-neon").css("background-image","url(assets/img/neon/"+neonid+"0"+$scope.game.neonIdx+".png)"),$scope.game.neonTimer=$timeout(function(){$scope.animateProfileNeon(neonid)},2e3)},$scope.newGame=function(hideLogged){$scope.game.DEBUG&&console.log("scope.newGame"),$scope.clickSound(),hideLogged?(TweenLite.to("#logged",$scope.game.tweenSpeed*2,{delay:.2,autoAlpha:0,ease:$scope.game.defaultEasingFunc}),$analytics.eventTrack("click-bouton",{category:"logged",label:"nouvelle-partie"})):$analytics.eventTrack("click-bouton",{category:"home-menu",label:"nouvelle-partie"}),$scope.openGarage()},$scope.newGameFromRules=function(){$scope.game.DEBUG&&console.log("scope.newGameFromRules"),$analytics.eventTrack("click-bouton",{category:"regles",label:"nouvelle-partie"}),$scope.clickSound(),$scope.openGarage()},$scope.reloadGame=function(){$scope.game.DEBUG&&console.log("scope.reloadGame for "+$scope.user.email),$.post("scripts/loadDB.php",{email:$scope.user.email},$scope.reloadGameCallback,"xml")},$scope.reloadGameCallback=function(xml){$scope.game.DEBUG&&console.log("scope.reloadGameCallback "+xml);var result=$(xml).find("result"),id=$(xml).find("id"),score=$(xml).find("score"),errors=$(xml).find("errors"),answers=$(xml).find("answers"),badges=$(xml).find("badges"),pins=$(xml).find("pins"),videos=$(xml).find("videos"),i=0;console.log("result : "+result.text()+" / score : "+score.text()+" / errors : "+errors.text()+" / answers : "+answers.text()+" / badges : "+badges.text()+" / videos : "+videos.text());if(Math.abs(result.text())==1){$scope.user.answers=$scope.game.foundedMoviesIdx=JSON.parse(answers.text().replace(/\\/g, "")),$scope.user.badges=JSON.parse(badges.text()),$scope.user.videos=JSON.parse(videos.text()),$scope.user.pins=JSON.parse(pins.text()),$scope.user.score=Math.abs(score.text()),$scope.user.errors=Math.abs(errors.text()),$scope.user.score<10?$scope.view.score="0"+$scope.user.score:$scope.view.score=$scope.user.score;if($scope.user.errors>0)for(var i=$scope.user.errors;i>0;i--)TweenLite.to("#error"+i,0,{color:"#ffffff"}),$("#error"+i).removeClass("error-off");for(i=0;i<$scope.user.pins.length;i++)$scope.addPin($scope.user.pins[i].x,$scope.user.pins[i].y);for(i=0;i<$scope.user.badges.length;i++)$scope.updateBadgesPage($scope.user.badges[i],$scope.user.videos[i],i);$scope.$digest(),$timeout($scope.lightUpGarage,600)}},$scope.restartGame=function(type){$scope.game.DEBUG&&console.log("scope.restartGame "+type),$scope.clickSound();var layers=$scope.game.layers;for(var i=0;i<15;i++)layers[i].alpha=0;$scope.game.container.removeChild($scope.game.endTitle),$scope.game.endTitle=null,TweenLite.to($scope.game.sounds.loopNeon,$scope.game.tweenSpeed,{volume:0,ease:$scope.game.defaultEasingFunc,onComplete:function(){$scope.game.sounds.loopNeon.stop(),$timeout.cancel($scope.game.neonTimer)}}),$scope.playSoundId($scope.game.sounds.DOOR),TweenLite.fromTo($("#end"),$scope.game.tweenSpeed*2.5,{top:0},{top:"-="+$("#end").height(),ease:$scope.game.defaultEasingFunc,onComplete:function(){$("#end").css("visibility","hidden");for(var i=1;i<=3;i++)TweenLite.to("#error"+i,0,{color:"#5f5f5f"});$scope.game.FPS=80,$scope.user.score=0,$scope.user.errors=0,$scope.user.answers=[],$scope.user.badges=[],$scope.user.pins=[],$scope.movie={},$scope.view.score="00",$scope.view.authErrorMsg="",$scope.view.previousPanel=undefined,$scope.resetPins(),$scope.game.pinPool=[],$scope.game.pinPoolTimeline=[],$scope.game.pinVisible=!1,$scope.game.foundedMoviesIdx=[],$scope.game.neonIdx=1,$scope.game.inputMode=!0,$scope.game.context="game",$scope.view.currentPanel=$("#garage"),$scope.resetBadgesPage(),$scope.$digest(),type=="reload"?$scope.reloadGame():$timeout($scope.lightUpGarage,600)}})},$scope.confirmQuit=function(){$scope.clickSound(),$scope.quitGameWithoutSave()},$scope.quitGame=function(){$scope.clickSound(),TweenLite.to("#quitconfirm",$scope.game.tweenSpeed,{autoAlpha:0,ease:$scope.game.defaultEasingFunc}),$scope.closeMainMenu(!0)},$scope.quitGameWithoutSave=function(){var tl=new TimelineLite;tl.to("#quitconfirm",0,{autoAlpha:1}),tl.to("#quitconfirm",0,{left:$(window).width()}),tl.to("#quitconfirm",$scope.game.tweenSpeed,{left:0,ease:$scope.game.defaultEasingFunc}),tl.play(),TweenLite.to($scope.view.currentPanel,$scope.game.tweenSpeed,{left:"-"+$(window).width(),ease:$scope.game.defaultEasingFunc,onComplete:function(){$scope.view.currentPanel.css("visibility","hidden"),$scope.view.previousPanel=$scope.view.currentPanel,$scope.view.currentPanel=$("#quitconfirm")}})},$scope.saveAndQuit=function(){$scope.clickSound(),$scope.user.logged?($scope.saveGameInDB(),$scope.quitGame()):$scope.connectGame("game-menu","save")},$scope.openGarage=function(){$scope.game.DEBUG&&console.log("openGarage "),$("#garage").css("visibility","visible"),TweenLite.to("#menu1",$scope.game.tweenSpeed*2,{delay:.2,autoAlpha:0,ease:$scope.game.defaultEasingFunc,onComplete:function(){$timeout($scope.lightUpGarage,600)}}),$scope.game.inputMode=!0,$scope.game.context="game",$scope.user.gameStarted=!0,$scope.view.currentPanel=$("#garage")},$scope.closeGarage=function(){var neonid=$scope.view.neonid;$scope.game.DEBUG&&console.log("closeGarage "+neonid),$(".profile-neon").css("background-image","url(assets/img/neon/"+neonid+"01.png)"),$("#end").css("visibility","visible").css("opacity","100").css("top","-="+$("#end").height()+"px"),$scope.playSoundId($scope.game.sounds.DOOR_OUT),TweenLite.to("#end",$scope.game.tweenSpeed*2.5,{top:0,ease:$scope.game.defaultEasingFunc,onComplete:function(){$scope.game.neonTimer=$timeout(function(){$scope.animateProfileNeon(neonid)},2e3);var ppc=(new createjs.PlayPropsConfig).set({interrupt:createjs.Sound.INTERRUPT_ANY,loop:-1,volume:$scope.game.sounds.ambianceLoopNeonVolume});$scope.game.sounds.loopNeon=createjs.Sound.play($scope.game.sounds.NEON_LOOP,ppc)}})},$scope.loadGameFromDB=function(){$scope.game.DEBUG&&console.log("scope.loadGameFromDB for "+$scope.user.email),$.post("scripts/loadDB.php",{email:$scope.user.email},$scope.loadDBCallback,"xml")},$scope.loadDBCallback=function(xml){$scope.game.DEBUG&&console.log("scope.loadDBCallback "+xml);var result=$(xml).find("result"),id=$(xml).find("id"),score=$(xml).find("score"),errors=$(xml).find("errors"),answers=$(xml).find("answers"),badges=$(xml).find("badges"),pins=$(xml).find("pins"),videos=$(xml).find("videos"),i=0;console.log("result : "+result.text()+" / score : "+score.text()+" / errors : "+errors.text()+" / answers : "+answers.text()+" / badges : "+badges.text()+" / videos : "+videos.text());if(Math.abs(result.text())==1){$scope.user.answers=$scope.game.foundedMoviesIdx=JSON.parse(answers.text().replace(/\\/g, "")),$scope.user.badges=JSON.parse(badges.text()),$scope.user.videos=JSON.parse(videos.text()),$scope.user.pins=JSON.parse(pins.text()),$scope.user.score=Math.abs(score.text()),$scope.user.errors=Math.abs(errors.text()),$scope.user.score<10?$scope.view.score="0"+$scope.user.score:$scope.view.score=$scope.user.score;if($scope.user.errors>0)for(var i=$scope.user.errors;i>0;i--)$("#error"+i).removeClass("error-off");for(i=0;i<$scope.user.pins.length;i++)$scope.addPin($scope.user.pins[i].x,$scope.user.pins[i].y);for(i=0;i<$scope.user.badges.length;i++)$scope.updateBadgesPage($scope.user.badges[i],$scope.user.videos[i],i);$scope.$digest()}},$scope.saveGameInDB=function(){$scope.game.DEBUG&&console.log("scope.saveGameInDB");var serializedAnswers=JSON.stringify($scope.user.answers),serializedBadges=JSON.stringify($scope.user.badges),serializedPins=JSON.stringify($scope.user.pins);$.post("scripts/saveDB.php",{name:$scope.user.name,email:$scope.user.email,score:$scope.user.score,errors:$scope.user.errors,lang:$scope.view.lang,answers:serializedAnswers,badges:serializedBadges,pins:serializedPins,type:$scope.user.type},$scope.saveDBCallback,"xml")},$scope.saveGameInDBLogged=function(){var tl=new TimelineLite;tl.to("#saved2",0,{autoAlpha:1}),tl.to("#saved2",0,{left:$(window).width()}),tl.to("#saved2",$scope.game.tweenSpeed,{left:0,ease:$scope.game.defaultEasingFunc}),tl.play(),TweenLite.to($scope.view.currentPanel,$scope.game.tweenSpeed,{left:"-"+$(window).width(),ease:$scope.game.defaultEasingFunc,onComplete:function(){$scope.view.currentPanel.css("visibility","hidden"),$scope.view.previousPanel=$scope.view.currentPanel,$scope.view.currentPanel=$("#saved2"),$scope.user.logged=!0}}),$scope.saveGameInDB()},$scope.saveDBCallback=function(xml){$scope.game.DEBUG&&console.log("scope.saveDBCallback "+xml),$scope.playSoundId($scope.game.sounds.BANJO)},$scope.loginGoogle=function(){$scope.game.DEBUG&&console.log("scope.loginGoogle"),gapi&&gapi.client.load("plus","v1",function(){var request=gapi.client.plus.people.get({userId:"me"});request.execute(function(resp){console.log("Good to see you, "+resp.name.givenName+".");var picture_url=resp.image.url;picture_url=picture_url.replace("?sz=50","?sz=100"),$scope.user.name=resp.name.givenName,$scope.user.email=resp.emails[0].value,$scope.user.picture=picture_url,$scope.user.type="gplus",$scope.$apply(),$("#avatar").attr("src",$scope.user.picture).attr("alt",$scope.user.name),$("#avatarLogged").attr("src",$scope.user.picture).attr("alt",$scope.user.name),$("#avatarSaved").attr("src",$scope.user.picture).attr("alt",$scope.user.name);var tl=new TimelineLite,panel;$scope.view.loadGame?(panel="#logged",$scope.loadGameFromDB($scope)):(panel="#saved",$scope.saveGameInDB($scope)),$scope.closeWaitWindow(),tl.to(panel,0,{autoAlpha:1}),tl.to(panel,0,{left:$(window).width()}),tl.to(panel,$scope.game.tweenSpeed,{left:0,ease:$scope.game.defaultEasingFunc}),tl.play(),TweenLite.to($scope.view.currentPanel,$scope.game.tweenSpeed,{left:"-"+$(window).width(),ease:$scope.game.defaultEasingFunc,onComplete:function(){$scope.playSoundId($scope.game.sounds.BANJO),$scope.view.currentPanel.css("visibility","hidden"),$scope.view.previousPanel=$scope.view.currentPanel,$scope.view.currentPanel=$(panel),$scope.user.logged=!0}})})})},$scope.loginTwitter=function(xml){$scope.closeWaitWindow(),$scope.game.DEBUG&&console.log("scope.loginTwitter "+xml);var response=$(xml).find("response");if(Math.abs(response.text())==1){var name=$(xml).find("name"),email=$(xml).find("email"),picture=$(xml).find("picture");console.log("Good to see you, "+name.text()+".");var picture_url=picture.text();picture_url=picture_url.replace("_normal.jpeg",".jpeg"),picture_url=picture_url.replace("_normal.jpg",".jpg"),picture_url=picture_url.replace("_normal.png",".png"),$scope.user.name=name.text(),$scope.user.email=email.text(),$scope.user.picture=picture_url,$scope.user.type="twitter",$scope.$apply(),$("#avatar").attr("src",$scope.user.picture).attr("alt",$scope.user.name),$("#avatarLogged").attr("src",$scope.user.picture).attr("alt",$scope.user.name),$("#avatarSaved").attr("src",$scope.user.picture).attr("alt",$scope.user.name);var tl=new TimelineLite,panel;$scope.view.loadGame?(panel="#logged",$scope.loadGameFromDB($scope),$analytics.eventTrack("auth-success",{category:"reprendre-partie",label:"twitter"})):(panel="#saved",$scope.saveGameInDB($scope),$analytics.eventTrack("auth-success",{category:"sauver-partie",label:"twitter"})),tl.to(panel,0,{autoAlpha:1}),tl.to(panel,0,{left:$(window).width()}),tl.to(panel,$scope.game.tweenSpeed,{left:0,ease:$scope.game.defaultEasingFunc}),tl.play(),TweenLite.to($scope.view.currentPanel,$scope.game.tweenSpeed,{left:"-"+$(window).width(),ease:$scope.game.defaultEasingFunc,onComplete:function(){$scope.playSoundId($scope.game.sounds.BANJO),$scope.view.currentPanel.css("visibility","hidden"),$scope.view.previousPanel=$scope.view.currentPanel,$scope.view.currentPanel=$(panel),$scope.user.logged=!0}})}else $scope.authError()},$scope.addSparkles=function(count,x,y,speed,velX){for(var i=0;i<count;i++){var sparkle=$scope.getSparkle();sparkle.x=x,sparkle.y=y,sparkle.alpha=1,sparkle.scaleX=sparkle.scaleY=Math.random()+.3,sparkle.rotation=Math.random()*360;var a=Math.PI*2*Math.random(),v=(Math.random()-.5)*30*speed;sparkle.vX=Math.cos(a)*v+velX,sparkle.vY=Math.sin(a)*v,sparkle.vA=-Math.random()*.05-.01,$scope.game.sparkleContainer.addChild(sparkle)}},$scope.getSparkle=function(){var s;return $scope.game.sparklePool.length>0?s=$scope.game.sparklePool.pop():s=new createjs.Bitmap($scope.game.sparkleShape.cacheCanvas),s}}]),createjs.Bitmap.prototype.setWidth=function(w){if(this.image.width==0)return;this.scaleX=w/this.image.width,console.log("setWidth "+this.scaleX)},createjs.Bitmap.prototype.setHeight=function(h){if(this.image.height==0)return;this.scaleY=h/this.image.height};